<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>快乐虫の地带</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="我的笔记">
<meta property="og:type" content="website">
<meta property="og:title" content="快乐虫の地带">
<meta property="og:url" content="http://happychong.github.io/page/2/index.html">
<meta property="og:site_name" content="快乐虫の地带">
<meta property="og:description" content="我的笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="happyChong">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="快乐虫の地带" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">快乐虫の地带</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://happychong.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="default-2020-07-22-Vue基础" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2020-07-22-Vue%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2022-03-29T02:49:29.886Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Vue/">Vue</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2020-07-22-Vue%E5%9F%BA%E7%A1%80/">Vue 基础知识</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>下文的vm表示Vue的实例</p>
<h2 id="1-vm的常用属性及方法"><a href="#1-vm的常用属性及方法" class="headerlink" title="1 vm的常用属性及方法"></a>1 vm的常用属性及方法</h2><ul>
<li>vm.$el : 渲染页面后的真实dom元素(Vue+Jquery项目中常用)</li>
<li>vm.$watch(prop, fn) : 监控vm的data的属性值变化，监控的是diff后的变化，连着改值，fn只会异步被触发一次(下一事件环之后才会被触发)</li>
<li>vm.$nextTick(fn) : 把fn放在下一事件环执行</li>
<li>vm.$data : 当前实例-vm 的数据-data</li>
<li>vm.$options : 整个vm对象</li>
<li>vm.$set() : 动态新增属性—新增的属性，不实时更新视图，$set设置可以实时</li>
<li>vm.$delete() : 动态删除属性—更新数组的length，不实时更新视图，$delete设置可以实时</li>
</ul>
<h2 id="2-常用指令"><a href="#2-常用指令" class="headerlink" title="2 常用指令"></a>2 常用指令</h2><p>指令的功能是封装dom操作的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* &#123;&#123; &#125;&#125; ： 小胡子语法 取值 运算(算出返回结果) 三元表达式 &#123;&#123; &#123;name:1&#125; &#125;&#125; - ok的(要有空格)</span><br></pre></td></tr></table></figure>
<ul>
<li>v-once ：只渲染一次，再改值，界面不变</li>
<li>v-html ：可以将模板字符串(<code>&lt;h1&gt;我是标题&lt;/h1&gt;</code>)渲染成页面中的标题，原理innerHTML，注意不要将用户输入的内容显示到页面上以防止xss攻击</li>
<li>v-bind ：动态绑定，缩写 : (冒号)</li>
<li>v-for ：循环，可以循环数组、对象、数字、字符串，要循环谁就把v-for写在谁的标签上</li>
<li><ul>
<li>循环内容为多标签的话，可以循环外层套 template 标签,此时:key放template里面的标签上</li>
</ul>
</li>
<li><ul>
<li>key ： 配合v-for使用，用key进行更新，所以key具有唯一性，尽量不要用数组的索引做key的值(除非只做静态展示可以使用key)，否则反序操作的时候，会把元素删除重新创建，如果key是唯一性的值，改变数据顺序，只会改变dom顺序，效率高</li>
</ul>
</li>
<li><ul>
<li>可以自己拼接key保证唯一性</li>
</ul>
</li>
<li>v-if &#x2F; else ：控制dom是否创建显示</li>
<li><ul>
<li>v-for 和 v-if 不要放在同一个标签中使用</li>
</ul>
</li>
<li>v-show ：控制dom显示，隐藏，不能在 template 标签上使用</li>
<li>v-on ：绑定事件方法，缩写 @ ex. @input @change</li>
<li>v-model ：双向绑定语法糖(能改内容的dom可以双向绑定) ,原理 :value + @input</li>
</ul>
<h2 id="fn"><a href="#fn" class="headerlink" title="fn"></a>fn</h2><p>vm的data中，可以定义方法，也可以成功执行，但是这个方法中的this会是windows</p>
<p>一般，我们在vm的methods中定义方法，这样方法中的this会是vm，但是methods中的方法中的this都定义成了vm，重新bind也无效，因为vue已经bind一次了，而bind绑定一次this就会绑死，多次绑定无效，这引发的问题就是这个方法如果在别的实例中应用会有问题，因为这个方法的this只能是当前实例</p>
<h2 id="自定义指令"><a href="#自定义指令" class="headerlink" title="自定义指令"></a>自定义指令</h2><h3 id="全局指令"><a href="#全局指令" class="headerlink" title="全局指令"></a>全局指令</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Vue 自定义全局指令 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue 自定义全局指令(directive)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">   1<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-focus1.a.b.c</span>=<span class="string">&quot;&#x27;xxx&#x27;&quot;</span>/&gt;</span> </span><br><span class="line">   2<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-focus2.color</span>=<span class="string">&quot;&#x27;red&#x27;&quot;</span>/&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 全局指令</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置方法1 = 设置方法2中只有 bind 和 update 的语法糖</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus1&#x27;</span>, <span class="keyword">function</span> (<span class="params">el, bindings, vNode</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// el - 当前指令元素</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// bindings - 绑定属性（修饰符-modifiers、表达式-expression、value等）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// vNode - 虚拟节点 有context属性代表当前指令的上下文</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 这个方法默认只在 bind（绑定）的时候和 update(更新-当前指令依赖的数据变化)的时候才会被执行</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(el, bindings, vNode);</span></span><br><span class="line"><span class="language-javascript">      el.<span class="title function_">focus</span>(); <span class="comment">// 没效果 因为页面还没初始化好el这个dom节点 应该插入dom之后再执行focus方法，如inserted中</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 设置方法2</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;focus2&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 指令的触发周期顺序(最常用的) bind -&gt; inserted -&gt; update -&gt; unbind</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// bind (el, bindings, vNode) &#123;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   console.log(el, bindings, vNode);</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   el.focus();</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   // 可以用 nextTick 实现 inserted 效果</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// &#125;,</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// update (el, bindings, vNode) &#123;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   console.log(el, bindings, vNode);</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   el.focus();</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// &#125;,</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">inserted</span>(<span class="params">el, bindings, vNode</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 插入（初始化）dom之后执行此方法</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 指令 focus2 中，有修饰符color的，把dom边框变成设置的颜色</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (bindings.<span class="property">modifiers</span>.<span class="property">color</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          el.<span class="property">style</span>.<span class="property">borderColor</span> = bindings.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        el.<span class="title function_">focus</span>(); <span class="comment">// focus2 指令的元素自动获取焦点</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">unbind</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 指令小会的时候 会触发此函数</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="组件内指令"><a href="#组件内指令" class="headerlink" title="组件内指令"></a>组件内指令</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Vue clickOutside指令 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue clickOutside指令<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.input</span> &#123; <span class="attribute">border</span>: <span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.content</span> &#123; <span class="attribute">background-color</span>: bisque;&#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    日历控件 | 弾层 ： </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-click-outside</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;isShow&quot;</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        内容</span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>加载更多内容<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">directives</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 局部指令 只当前vm有效</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">clickOutside</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// 可以实现 点击时判断是否存在当前dom中</span></span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">bind</span>(<span class="params">el, bindings, vNode</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            el.<span class="property">fn</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="keyword">if</span> (el.<span class="title function_">contains</span>(e.<span class="property">target</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">                vNode.<span class="property">context</span>.<span class="title function_">showContent</span>();</span></span><br><span class="line"><span class="language-javascript">              &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                vNode.<span class="property">context</span>.<span class="title function_">hideContent</span>();</span></span><br><span class="line"><span class="language-javascript">              &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, el.<span class="property">fn</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">unbind</span>(<span class="params">el</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// 事件绑定必须要解绑</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, el.<span class="property">fn</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">isShow</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">showContent</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">isShow</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">hideContent</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">isShow</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="computed-amp-watch-的区别"><a href="#computed-amp-watch-的区别" class="headerlink" title="computed &amp; watch 的区别"></a>computed &amp; watch 的区别</h2><p>computed 计算：会根据其他的值来计算，特点：内部具有缓存，如果依赖的属性没有变化，不会重新执行对应的函数，依赖的属性变化，再重新执行</p>
<p>watch 监控：监控某个值的变化，每次值变化后，都能执行对应的回调</p>
<p>computed 和 watch 都是基于 vm.$watch 实现的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- computed &amp; watch --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Vue clickOutside指令<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.input</span> &#123; <span class="attribute">border</span>: <span class="number">1px</span> solid red;&#125;</span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.content</span> &#123; <span class="attribute">background-color</span>: bisque;&#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;z3&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// name: &#123;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//   n: &#x27;l4&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// watch: &#123;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   // 当一个值变化了，可以做其他的事</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   name: &#123;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//     handler(newValue) &#123;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//       console.log(&#x27;watch ::&#x27;, newValue);</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//     &#125;,</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//     immediate: true, // 立即执行handler 初始化时候就执行</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//     deep: true, // 深度监控 ex. name.n 变化，也会触发 watch 方法，newValue 是name，不是name.n</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//     lazy: true // 是 computed 的实现</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//   &#125;</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// &#125;,</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">computed</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fullName</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> vm.<span class="property">name</span> + <span class="string">&#x27;-jw&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Vue 的 watch 实现 - 注释掉上面的watch，这里模拟设置监控</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// function initWatch(watch) &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   for (let key in watch) &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//     vm.$watch(key, watch[key]);</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   &#125;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// initWatch(&#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   name(newValue) &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//     console.log(newValue);</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   &#125;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// Vue 的 computed 实现 - 注释掉上面的computed，这里模拟设置 computed</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// let dirty = true; // 获取过就不再执行handler方法，直接返回已经计算出的结果</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// function initComputed(key, handler) &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   let value;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   Object.defineProperty(vm, key, &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//     get() &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//       if (dirty) &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//         value = handler();</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//         dirty = false;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//       &#125;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//       return value;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//     &#125;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   &#125;)</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// initComputed(&#x27;fullName&#x27;, () =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   console.log(&#x27;computed handler run&#x27;);</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//   return vm.name + &#x27;jw&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &#125;);</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// vm.fullName</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// vm.fullName</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// // ↑ vm.fullName 重新获取，不重新执行handler方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// vm.name = &#x27;xxx&#x27;;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// dirty = true; // name 重新赋值，实际相当于 dirty 重置为 true</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// vm.fullName // 所以这里获取 fullName ，重新执行handler方法</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Vue-的生命周期"><a href="#Vue-的生命周期" class="headerlink" title="Vue 的生命周期"></a>Vue 的生命周期</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生命周期的执行是同步的，其中包含异步逻辑的话，不会等待，直接执行后续的函数</span></span><br><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="comment">// 当前这个实例他的父亲是谁 儿子是谁</span></span><br><span class="line">  <span class="title function_">beforeCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 组件创建之前 - 初始化好了基础属性，基础事件（$on $emit 等）</span></span><br><span class="line">    <span class="comment">// 但this（vm）中不包含vm的数据(data)、方法、watch等，所以基本上业务逻辑不需要使用这个钩子</span></span><br><span class="line">    <span class="comment">// 混合 ： 我希望在每个组件中增加一些特定的属性，可以采用这个钩子</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>, <span class="string">&#x27;beforeCreate-组件创建之前--&#x27;</span>, <span class="variable language_">this</span>.<span class="property">n</span>); <span class="comment">// 没有n</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 创建完成 - 当前这个组件实例，已经实现了数据劫持（数据已经加了get，set），并把方法、计算属性都挂载到了实例上</span></span><br><span class="line">    <span class="comment">// 但是不能获取到真是的dom元素，不能操作dom</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>, <span class="string">&#x27;created-创建完成--&#x27;</span>, <span class="variable language_">this</span>.<span class="property">$el</span>); <span class="comment">// 没有dom</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// el: &#x27;#app&#x27;, // 同vm.$mount(&#x27;#app&#x27;);</span></span><br><span class="line">  <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果有的render 就不会使用template内容了，</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>, <span class="string">&#x27;render&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123;&#125;, [<span class="string">&#x27;render方法创建的&#x27;</span>])</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// template: `&lt;div&gt;hello&lt;/div&gt;`, // 会把template变成render方法</span></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">n</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 挂载之前 - beforeMount中会默认调用render方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>, <span class="string">&#x27;beforeMount-挂载之前 --&#x27;</span>, <span class="variable language_">this</span>.<span class="property">$el</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123; <span class="comment">// 这个过程中，如果有子组件，会走子组件的生命周期，洋葱模式</span></span><br><span class="line">    <span class="comment">// 当前组件挂载完成 - 有了真实的dom</span></span><br><span class="line">    <span class="comment">// 一般把ajax的操作，在这里完成，既能得到vm数据，又有$el方便操作</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>, <span class="string">&#x27;mounted-挂载完成 --&#x27;</span>, <span class="variable language_">this</span>.<span class="property">$el</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Vue 更新方式是组件级别的</span></span><br><span class="line">  <span class="comment">// 组件化的好处 1：方便复用，好维护 2：减少不必要的更新渲染</span></span><br><span class="line">  <span class="title function_">beforeUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 更新之前 - Vue的更新是diff更新，需要更新的数据在视图中显示，才会触发beforeUpdate</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeUpdate-更新之前&#x27;</span>);</span><br><span class="line">    <span class="comment">// 我们可以在这里增加一些数据更新，不会导致视图多次更新，很少用</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">updated</span>(<span class="params"></span>) &#123; <span class="comment">// 这里不要再更新数据，可能会死循环</span></span><br><span class="line">    <span class="comment">// 更新完成</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;updated-更新完成&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 触发销毁的方式：- 销毁后会默认移除所有观察者，移除监听事件（watcher.active = false），视图并不会刷新</span></span><br><span class="line">  <span class="comment">// 1-手动移除组件（vm.$destroy()）</span></span><br><span class="line">  <span class="comment">// 2-路由切换</span></span><br><span class="line">  <span class="title function_">beforeDestroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 销毁之前 - 可以做事件移除 清空定时器等</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;beforeDestroy-销毁之前&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">destroyed</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 销毁后</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;destroyed-销毁后&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// $mount 挂载节点</span></span><br><span class="line">vm.$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"><span class="comment">// 可以指定一个元素，作为渲染内容的父节点</span></span><br><span class="line"><span class="comment">// vm.$mount();</span></span><br><span class="line"><span class="comment">// 不指定（参数为空）元素的话，内部会默认渲染到内存中的一个节点，可以原生js自己appendChild到页面中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建的内容-优先级：</span></span><br><span class="line"><span class="comment">// 1：render方法中返回的dom节点</span></span><br><span class="line"><span class="comment">// 2：template。会把template变成render方法</span></span><br><span class="line"><span class="comment">// 3：dom中的挂载节点的内容 ex. &lt;div id=&quot;app&quot;&gt;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vm.<span class="property">$el</span>);</span><br></pre></td></tr></table></figure>

<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h2><p>组件的目的：复用、方便维护、减少渲染</p>
<p>组件的分类：全局组件、局部组件、指令组件</p>
<p>组件的使用：</p>
<ul>
<li>1.导入组件</li>
<li>2.注册</li>
<li>3.使用 - 在当前组件定义的模板中使用</li>
</ul>
<h3 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">all-component</span>&gt;</span><span class="tag">&lt;/<span class="name">all-component</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">all-component</span>&gt;</span><span class="tag">&lt;/<span class="name">all-component</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;/all-component&gt;&lt;/all-component&gt;&lt;/all-component&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      html中应用要注意：</span></span><br><span class="line"><span class="comment">      1.不支持自定义闭合标签</span></span><br><span class="line"><span class="comment">      2.标签名不要和原生标签重名</span></span><br><span class="line"><span class="comment">      3.如果组件名有大写的情况会默认转为小写，会有问题，因为html标签无大写，要全部采用小写+短横线（-）方式</span></span><br><span class="line"><span class="comment">      4.组件应该是独立的，每个组件间应该是不想管的，并且单项数据流，所以data要是函数，返回独立的&#123;&#125;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 组件的目的：复用、方便维护、减少渲染</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 组件的分类：全局组件、局部组件、指令组件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;all-component&#x27;</span>, &#123; <span class="comment">// 注册全局组件</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">template</span>: <span class="string">`&lt;div&gt;全局组件内容&lt;/div&gt;`</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;&#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="局部组件"><a href="#局部组件" class="headerlink" title="局部组件"></a>局部组件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">inner-component</span> <span class="attr">:money</span>=<span class="string">&quot;money&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">inner-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./node_modules/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 每个组件都应该有3部分 1-html 2-js 3-style</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> component = &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">template</span>: <span class="string">`&lt;div&gt;子组件&lt;/br&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        My father&#x27;s money is &#123;&#123; money &#125;&#125; .</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        &lt;button @click=&quot;addMoney&quot;&gt;我赚10元给father&lt;/button&gt;&lt;/br&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        My house : &#123;&#123; house &#125;&#125;&lt;/br&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        My dog : &#123;&#123; dog &#125;&#125;&lt;/br&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        &lt;/div&gt;`</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> &#123;<span class="attr">n</span>: <span class="number">1</span>&#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// props: [&#x27;money&#x27;], // 直接拿属性用</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">props</span>: &#123; <span class="comment">// 对属性进行校验</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// money: &#123;&#125; // 不校验 等于上面数组写法</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// money: Number // </span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">money</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="title class_">Number</span>, <span class="comment">// 类型校验 - money为Number类型</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">required</span>: <span class="literal">true</span>, <span class="comment">// 必填校验</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">default</span>: <span class="number">10</span> <span class="comment">// 设置默认值</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">house</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="title class_">Array</span>, <span class="comment">// Array 或者 Object 类型的时候，并且设置默认值，默认值设置需要用函数返回值方式设置</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> [<span class="number">1</span>]</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">dog</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">type</span>: <span class="title class_">Object</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">default</span>: <span class="function">() =&gt;</span> (&#123;<span class="attr">a</span>: <span class="number">1</span>&#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">addMoney</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// this.money = this.money + 10; // 不应该子组件修改父组件的数据</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">money</span>: <span class="number">100</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">house</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">components</span>: &#123; <span class="comment">// 在实例上注册组件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="string">&#x27;inner-component&#x27;</span>: component</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;)</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="dispatch-向上触发事件方法"><a href="#dispatch-向上触发事件方法" class="headerlink" title="dispatch 向上触发事件方法"></a>dispatch 向上触发事件方法</h3><p>dispatch Vue1.0的时候有，2.0以后，就被干掉了，下面是自己封装方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$dispatch</span> = <span class="keyword">function</span> (<span class="params">eventName, value</span>) &#123;</span><br><span class="line">  <span class="comment">// 触发所有层级的父亲上的eventName事件</span></span><br><span class="line">  <span class="keyword">let</span> parent = <span class="variable language_">this</span>.<span class="property">$parent</span>;</span><br><span class="line">  <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">    parent.$emit(eventName, value);</span><br><span class="line">    parent = parent.<span class="property">$parent</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="broadcast-广播-触发所有子组件带有eat的事件方法"><a href="#broadcast-广播-触发所有子组件带有eat的事件方法" class="headerlink" title="broadcast 广播 - 触发所有子组件带有eat的事件方法"></a>broadcast 广播 - 触发所有子组件带有eat的事件方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$broadcast</span> = <span class="keyword">function</span> (<span class="params">eventName, value</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> children = <span class="variable language_">this</span>.<span class="property">$children</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">booad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    children.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">      child.$emit(eventName, value);</span><br><span class="line">      <span class="keyword">if</span> (child.<span class="property">$children</span>) &#123;</span><br><span class="line">        <span class="title function_">booad</span>(child.<span class="property">$children</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">booad</span>(children);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h3><p><a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/15.Vue/12-last">文件源码地址</a></p>
<h4 id="父传递给子数据-props-emit"><a href="#父传递给子数据-props-emit" class="headerlink" title="父传递给子数据 props emit"></a>父传递给子数据 props emit</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  props --》 count</span></span><br><span class="line"><span class="comment">  emit ---》 changeCount() &#123; this.$emit(&#x27;update:count&#x27;, 5) &#125;</span></span><br><span class="line"><span class="comment">  以下写法是演变过程 与 语法糖 其实都是一样的功能</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 写法1 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">:count</span>=<span class="string">&quot;count&quot;</span> @<span class="attr">update:count</span>=<span class="string">&quot;changeCount&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 写法2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">:count</span>=<span class="string">&quot;count&quot;</span> @<span class="attr">update:count</span>=<span class="string">&quot;newValue =&gt; count = newValue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 写法3 .sync写法，组件内需要触发（emit）的方法执行，必须是update:当前属性名（这里是count）方式触发--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">:count.sync</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 写法4 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">:value</span>=<span class="string">&quot;count&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;newValue =&gt; count = newValue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 写法5 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">v-model</span>=<span class="string">&quot;count&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="parent-children"><a href="#parent-children" class="headerlink" title="$parent $children"></a>$parent $children</h4><p>$parent — 获取父组件，$children — 获取所有子组件</p>
<h4 id="attrs-listeners"><a href="#attrs-listeners" class="headerlink" title="$attrs $listeners"></a>$attrs $listeners</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">grandSon</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;$listeners&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;eat&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;show&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">grandSon</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    v-bind=&quot;$attrs&quot; 这是直接把当前组件所有的属性都传到 grandSon 组件</span></span><br><span class="line"><span class="comment">    v-on=&quot;$listeners&quot; : 把所有方法都传给子组件</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="provide-inject-和-context"><a href="#provide-inject-和-context" class="headerlink" title="provide inject 和 context"></a>provide inject 和 context</h4><p>可以在父组件中声明公共数据，在子组件中注入，比较混乱-名称问题，不知道拿的谁的数据，一般不在业务代码中使用，多用于组件库中多及通信</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// provide inject</span></span><br><span class="line"><span class="comment">// 子组件中 - git\2019-zhufeng\15.Vue\12-last\components\grandSon.vue</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">inject</span>: [<span class="string">&#x27;vm&#x27;</span>], <span class="comment">// inject 注入，会向上查找（找到就停止，比如son中也provide暴露了vm，那找到的就是son的），这里直接拿到了App.vue provide 的内容</span></span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;vm&#x27;</span>, <span class="variable language_">this</span>.<span class="property">vm</span>); <span class="comment">// 这里直接获取到了App.vue 实例</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// App.vue中</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">provide</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="comment">// 暴露全局方法</span></span><br><span class="line">      <span class="attr">vm</span>: <span class="variable language_">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">doFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;doFn&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h4><p>获取真实的dom元素，如果放到组件上代表当前组件的实例，ref不要重名，会被覆盖，只有v-for循环的时候才会是数组形式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- parent --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Son</span> <span class="attr">ref</span>=<span class="string">&quot;son&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parent</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">   <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">son</span>.<span class="title function_">show</span>(); <span class="comment">// 父组件直接调用了子组件的方法</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// son</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;show&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="eventbus"><a href="#eventbus" class="headerlink" title="eventbus"></a>eventbus</h4><p>以上方式的绑定，都是只能在当前绑定事件的组建中才能触发事件，比如A实例绑定的aListeners   a.$on(‘aListeners’)，只能在A实例中才能触发 a.$emit(‘aListeners’, ‘hi’)，如果B想触发，需要找到A，在A上触发，不可以直接触发 不可以直接b.$emit(‘aListeners’, ‘hi’)。</p>
<p>eventbus 思路就是创建一个C实例，给c绑定一个事件，那么我们可以在a中触发c的事件 –》 c.$emit()，也可以在b中触发c的事件，谁都可以触发c的事件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里代表3个文件内容，main，parent，和grandson</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js - Vue中创建全局对象</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"><span class="comment">// 创建一个全局的发布订阅，数据流很混乱，偶尔用一次还可以</span></span><br><span class="line"><span class="comment">// $bus 只要创建一个有发布订阅功能的对象就行了，new Vue()就有</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$bus</span> = <span class="keyword">new</span> <span class="title class_">Vue</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// parent - 全局对象绑定事件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 绑定 $bus 事件   this.$bus是全局的，绑定好后，就可以任意位置触发了</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$bus</span>.$on(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;this.$bus.$on 执行了&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// grandson - 触发绑定的事件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$bus</span>.$emit(<span class="string">&#x27;change&#x27;</span>); <span class="comment">// 触发 $bus 事件</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="递归组件（菜单组件）"><a href="#递归组件（菜单组件）" class="headerlink" title="递归组件（菜单组件）"></a>递归组件（菜单组件）</h3><p>递归组件 - 需要给当前要递归的组件提供一个name属性，并且可以在当前组件内部，通过name来调用自己</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- - git\2019-zhufeng\15.Vue\13-menu\ReSub.vue 这是一个递归组件（reSub），整体案例是无限极菜单 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mySubMenu</span> <span class="attr">v-if</span>=<span class="string">&quot;data &amp;&amp; data.children &amp;&amp; data.children.length &gt; 0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123; data.name &#125;&#125;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-for</span>=<span class="string">&quot;item in data.children&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">reSub</span> <span class="attr">:data</span>=<span class="string">&quot;item&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">reSub</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mySubMenu</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">myMenuItem</span> <span class="attr">v-else</span> <span class="attr">:key</span>=<span class="string">&quot;data.id&quot;</span>&gt;</span>&#123;&#123; data.name &#125;&#125;<span class="tag">&lt;/<span class="name">myMenuItem</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mySubMenu <span class="keyword">from</span> <span class="string">&quot;./components/my-submenu&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> myMenuItem <span class="keyword">from</span> <span class="string">&quot;./components/my-menu-item&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;reSub&#x27;</span>, <span class="comment">// 递归组件 - 需要给当前要递归的组件提供一个name属性，并且可以在当前组件内部，通过name来调用自己</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    myMenuItem,</span><br><span class="line">    mySubMenu</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/tree/master/15.Vue/13-menu">源码地址</a></p>
<h3 id="函数组件"><a href="#函数组件" class="headerlink" title="函数组件"></a>函数组件</h3><p><a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/blob/master/15.Vue/14-render/src/components/levelFunction.js">源码地址</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    函数组件：</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">levelFunction</span> <span class="attr">type</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">:x</span>=<span class="string">&quot;1&quot;</span> <span class="attr">y</span>=<span class="string">&#x27;5&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">levelFunction</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> levelFunction <span class="keyword">from</span> <span class="string">&#x27;./components/levelFunction.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    levelFunction</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;h1&#x27;</span>, &#123;&#125;, <span class="string">&#x27;.vue文件，写了template，再写render方法，render方法失效&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/levelFunction.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vue 3.0 写法</span></span><br><span class="line"><span class="comment">// import &#123; h &#125; from &#x27;vue&#x27;;</span></span><br><span class="line"><span class="comment">// const DynamicHeading = (props, context) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log(props);</span></span><br><span class="line"><span class="comment">//     return h(`h$&#123;props.type&#125;`, context.attrs, context.slots)</span></span><br><span class="line"><span class="comment">//     // h 函数最好不要改名，有的浏览器固定了这个名字</span></span><br><span class="line"><span class="comment">//     // h 函数 第一个参数：标签名  第二个参数：属性对象   第三个参数：childrens</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// DynamicHeading.props = [&#x27;type&#x27;]</span></span><br><span class="line"><span class="comment">// export default DynamicHeading</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下为 vue2 写法 </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">val</span>: <span class="string">&#x27;你好&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="title function_">input</span>(<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">render</span>(<span class="params">h</span>) &#123;</span><br><span class="line">        <span class="comment">// render中的this 指当前组件实例</span></span><br><span class="line">        <span class="comment">// 函数组件的render中，第一个参数为h，类似createElement方法</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以下这种写法，dom结构复杂的话，写起来比较费劲</span></span><br><span class="line">        <span class="comment">// return h(&#x27;h&#x27; + this.type, &#123;&#125;, [</span></span><br><span class="line">        <span class="comment">//     this.$slots.default,</span></span><br><span class="line">        <span class="comment">//     h(&#x27;h6&#x27;, &#123;</span></span><br><span class="line">        <span class="comment">//         on: &#123;</span></span><br><span class="line">        <span class="comment">//             click() &#123;</span></span><br><span class="line">        <span class="comment">//                 console.log(&#x27;绑定事件&#x27;);</span></span><br><span class="line">        <span class="comment">//             &#125;</span></span><br><span class="line">        <span class="comment">//         &#125;,</span></span><br><span class="line">        <span class="comment">//         attrs: &#123;</span></span><br><span class="line">        <span class="comment">//             x: 1,</span></span><br><span class="line">        <span class="comment">//             y: &#x27;5&#x27;</span></span><br><span class="line">        <span class="comment">//         &#125;</span></span><br><span class="line">        <span class="comment">//     &#125;),</span></span><br><span class="line">        <span class="comment">//     &#x27;the last child&#x27;</span></span><br><span class="line">        <span class="comment">// ]);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 所以用jsx （js + xml）来写更方便点</span></span><br><span class="line">        <span class="comment">// let tag = &#x27;h&#x27; + this.type;</span></span><br><span class="line">        <span class="comment">// return &lt;tag x=&#123;this.x&#125; z=&#x27;0&#x27;&gt;</span></span><br><span class="line">        <span class="comment">//     &#123;this.$slots.default&#125;</span></span><br><span class="line">        <span class="comment">// &lt;/tag&gt; </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 但是不能用指令v-model了，指令部分如下代码</span></span><br><span class="line">        <span class="comment">// return &lt;input type=&quot;text&quot; value=&#123;this.val&#125; on-input=&#123;this.input&#125;&gt;&lt;/input&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 以下为v-html写法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">domPropsInnerHTML</span>=<span class="string">&quot;&lt;span&gt;1234567890&lt;/span&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">        <span class="comment">// https://github.com/vuejs/babel-plugin-transform-vue-jsx 文档</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="slot-scope"><a href="#slot-scope" class="headerlink" title="slot scope"></a>slot scope</h3><p><a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/blob/master/15.Vue/14-render/src/components/listComponent.vue">源码地址</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// App.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">  </span><br><span class="line">    slot</span><br><span class="line">    &lt;listComponent :arr=&quot;arr&quot;&gt;</span><br><span class="line">      &lt;template v-slot:default=&quot;obj&quot;&gt;</span><br><span class="line">        &lt;span&gt;# &#123;&#123; obj &#125;&#125; - &#123;&#123; obj ? obj.item : obj &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/listComponent&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import listComponent from &#x27;./components/listComponent.vue&#x27;;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    listComponent</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      arr: [1,2,3]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// components/listComponent.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li v-for=&quot;item of arr&quot; :key=&quot;item&quot;&gt;</span><br><span class="line">            &lt;!-- 这里的slot标签的属性像外传递到写v-slot的位置 --&gt;</span><br><span class="line">            &lt;!--  $slots.default() - vue3写法 --&gt;</span><br><span class="line">            &lt;slot v-if=&quot;$slots.default &amp;&amp; $slots.default()&quot; :item=&quot;item&quot; x=&quot;0&quot;&gt;&lt;/slot&gt;</span><br><span class="line">            &lt;template v-else&gt;000&lt;/template&gt;</span><br><span class="line">            &lt;!-- 作用域插槽 slot 可以将组建的内容共享、复用 --&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        props: [&#x27;arr&#x27;]</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="vue-use（message-UI）"><a href="#vue-use（message-UI）" class="headerlink" title="vue.use（message UI）"></a>vue.use（message UI）</h3><p><a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/blob/master/15.Vue/14-render/src">源码地址</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue3 写法</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> newUIMessage <span class="keyword">from</span> <span class="string">&#x27;./components/messageUpper.js&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use 方法会默认调用组件的install方法</span></span><br><span class="line">app.<span class="title function_">use</span>(newUIMessage);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// App.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button @click=&quot;upperMessage&quot;&gt;弹出弹层&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;button @click=&quot;upperMessage2&quot;&gt;弹出弹层2&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; Message &#125; from &#x27;./components/messageUpper.js&#x27;;</span><br><span class="line">export default &#123;</span><br><span class="line">  methods: &#123;</span><br><span class="line">    upperMessage() &#123;</span><br><span class="line">      Message.success(&#123;</span><br><span class="line">        message: &#x27;hello&#x27;,</span><br><span class="line">        duration: 3000</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    upperMessage2() &#123;</span><br><span class="line">      this.$message.success(&#123;</span><br><span class="line">        message: &#x27;你好&#x27;,</span><br><span class="line">        duration: 3000</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./components/messageUpper.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 模仿element-ui Message</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MessageComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./messageUpper.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createVNode, h, render &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> time = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> vnode = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">Message</span> = &#123;</span><br><span class="line">    <span class="title function_">success</span>(<span class="params">opts</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.message-wrapper&#x27;</span>)) &#123;</span><br><span class="line">            vnode = <span class="title function_">h</span>(<span class="title class_">MessageComponent</span>, &#123; <span class="attr">ref</span>:<span class="string">&#x27;vnode&#x27;</span> &#125;);</span><br><span class="line">            <span class="title function_">render</span>(vnode, <span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line">            vnode.<span class="property">component</span>.<span class="property">ctx</span>.<span class="title function_">addUpper</span>(opts);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            vnode.<span class="property">component</span>.<span class="property">ctx</span>.<span class="title function_">addUpper</span>(opts);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">info</span>(<span class="params">opts</span>) &#123;&#125;,</span><br><span class="line">    <span class="title function_">warn</span>(<span class="params">opts</span>) &#123;&#125;,</span><br><span class="line">    <span class="title function_">error</span>(<span class="params">opts</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="title function_">install</span>(<span class="params">_Vue, a,b,c</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(_Vue, a,b,c);</span><br><span class="line">        <span class="comment">// _Vue vue3中是当前根节点的实例， vue2中应该是Vue的构造函数</span></span><br><span class="line">        <span class="comment">// 注册全局组件、注册全局指令、往原型上添加方法&amp;属性</span></span><br><span class="line">        <span class="keyword">let</span> $message = &#123;&#125;;</span><br><span class="line">        <span class="comment">// 采用拷贝的方式，防止别人增加一个属性，加到原有的对象上</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="title class_">Message</span>)) &#123;</span><br><span class="line">            $message[key] = <span class="title class_">Message</span>[key];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 原型上注册$message方法</span></span><br><span class="line">        _Vue.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$message</span> = $message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// ./components/messageUpper.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div ref=&quot;upper&quot; class=&quot;message-wrapper&quot;&gt;</span><br><span class="line">    &lt;div v-for=&quot;upper in arr&quot; :key=&quot;upper.id&quot;&gt;&#123;&#123; upper.opts.message &#125;&#125; ： &#123;&#123; upper.id &#125;&#125;&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const Message = &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    // lastId 不需要监控变化，所以不写return里</span><br><span class="line">    this.lastId = 0;</span><br><span class="line">    return &#123;</span><br><span class="line">      arr: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    addUpper(opts) &#123;</span><br><span class="line">      let tempId = this.lastId++;</span><br><span class="line">      let obj = &#123;</span><br><span class="line">        id: tempId,</span><br><span class="line">        opts: opts</span><br><span class="line">      &#125;;</span><br><span class="line">      obj.timer = setTimeout(() =&gt; &#123;</span><br><span class="line">        clearTimeout(obj.timer);</span><br><span class="line">        Reflect.deleteProperty(this.arr, tempId)</span><br><span class="line">      &#125;, opts.duration);</span><br><span class="line">      this.arr[tempId] = obj;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">export default Message;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2020-07-22-Vue%E5%9F%BA%E7%A1%80/" data-id="cl1fzqfxy0013vgnu5keaefnb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2020-04-23-ast" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2020-04-23-ast/" class="article-date">
  <time datetime="2022-03-29T02:49:29.885Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2020-04-23-ast/">ast（语法树）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="1-ast-步骤"><a href="#1-ast-步骤" class="headerlink" title="1-ast 步骤"></a>1-ast 步骤</h2><ul>
<li>1.根据源代码生成语法树token数组</li>
<li>2.转换语法树</li>
<li>3.根据语法树生成转换后的代码</li>
</ul>
<h3 id="生成语法树token数组"><a href="#生成语法树token数组" class="headerlink" title="生成语法树token数组"></a>生成语法树token数组</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分词，把token拆开   词法分析：就是把代码转换成一个token流，其实就是一个token的数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">lexical</span>(<span class="params">code</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> tokens = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; code.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> ch = code.<span class="title function_">charAt</span>(i); <span class="comment">// l</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/[a-zA-Z]/</span>.<span class="title function_">test</span>(ch)) &#123;</span><br><span class="line">      <span class="comment">// 标识符 | 关键字</span></span><br><span class="line">      <span class="keyword">let</span> token = &#123; <span class="attr">type</span>: <span class="string">&#x27;Identifier&#x27;</span>, <span class="attr">value</span>: ch&#125;;</span><br><span class="line">      tokens.<span class="title function_">push</span>(token);</span><br><span class="line">      <span class="keyword">for</span> (i++; i &lt; code.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        ch = code.<span class="title function_">charAt</span>(i); <span class="comment">// e</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="regexp">/[a-zA-Z]/</span>.<span class="title function_">test</span>(ch)) &#123;</span><br><span class="line">          token.<span class="property">value</span> += ch;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (token.<span class="property">value</span> === <span class="string">&#x27;let&#x27;</span>) &#123;</span><br><span class="line">            token.<span class="property">type</span> = <span class="string">&#x27;Keyword&#x27;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          i--;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/\s/</span>.<span class="title function_">test</span>(ch)) &#123;</span><br><span class="line">      <span class="keyword">let</span> token = &#123; <span class="attr">type</span>: <span class="string">&#x27;WhiteSpace&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27; &#x27;</span>&#125;;</span><br><span class="line">      tokens.<span class="title function_">push</span>(token);</span><br><span class="line">      <span class="keyword">for</span> (i++; i &lt; code.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        ch = code.<span class="title function_">charAt</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="regexp">/\s/</span>.<span class="title function_">test</span>(ch)) &#123;</span><br><span class="line">          i--;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ch === <span class="string">&#x27;=&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> token = &#123; <span class="attr">type</span>: <span class="string">&#x27;Equal&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;=&#x27;</span>&#125;;</span><br><span class="line">      tokens.<span class="title function_">push</span>(token);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ch === <span class="string">&#x27;&lt;&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> token = &#123; type : <span class="string">&#x27;JSXElement&#x27;</span>, <span class="attr">value</span>: ch&#125;;</span><br><span class="line">      tokens.<span class="title function_">push</span>(token);</span><br><span class="line">      <span class="keyword">let</span> isClose = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">for</span> (i++; i &lt; code.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        ch = code.<span class="title function_">charAt</span>(i);</span><br><span class="line">        <span class="keyword">if</span> (ch === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">          isClose = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ch === <span class="string">&#x27;&gt;&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (isClose) &#123;</span><br><span class="line">            token.<span class="property">value</span> += ch;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            token.<span class="property">value</span> += ch;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          token.<span class="property">value</span> += ch;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tokens</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> sourceCode = <span class="string">`let  element = &lt;h1&gt;hello&lt;/h1&gt;;`</span></span><br><span class="line"><span class="keyword">let</span> tokens = <span class="title function_">lexical</span>(sourceCode);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tokens);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [</span></span><br><span class="line"><span class="comment"> *    &#123;type: &#x27;KeyWord&#x27;, value: &#x27;let&#x27;&#125;,</span></span><br><span class="line"><span class="comment"> *    &#123;type: &#x27;WhiteSpace&#x27;, value: &#x27; &#x27;&#125;,</span></span><br><span class="line"><span class="comment"> *    &#123;type: &#x27;Identifier&#x27;, value: &#x27;element&#x27;&#125;,</span></span><br><span class="line"><span class="comment"> *    &#123;type: &#x27;Equal&#x27;, value: &#x27;=&#x27;&#125;,</span></span><br><span class="line"><span class="comment"> *    &#123;type: &#x27;JSXElement&#x27;, value: &#x27;&lt;h1&gt;hello&lt;/h1&gt;&#x27;&#125;</span></span><br><span class="line"><span class="comment"> * ]</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="tokens转换成语法树"><a href="#tokens转换成语法树" class="headerlink" title="tokens转换成语法树"></a>tokens转换成语法树</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tokens转换成语法树</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parse</span>(<span class="params">tokens</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ast = &#123; <span class="attr">type</span>: <span class="string">&#x27;Program&#x27;</span>, <span class="attr">body</span>: [], <span class="attr">sourceType</span>: <span class="string">&#x27;module&#x27;</span> &#125;;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span>; <span class="comment">// 当前的索引</span></span><br><span class="line">  <span class="keyword">let</span> currentToken; <span class="comment">// 当前的token</span></span><br><span class="line">  <span class="keyword">while</span> (currentToken = tokens[i]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (currentToken.<span class="property">type</span> === <span class="string">&#x27;Keyword&#x27;</span> &amp;&amp; currentToken.<span class="property">value</span> === <span class="string">&#x27;let&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="title class_">VariableDeclaration</span> = &#123; <span class="attr">type</span>: <span class="string">&#x27;VariableDeclaration&#x27;</span>, <span class="attr">declarations</span>: []&#125;;</span><br><span class="line">      ast.<span class="property">body</span>.<span class="title function_">push</span>(<span class="title class_">VariableDeclaration</span>);</span><br><span class="line">      i += <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">let</span> curToken = tokens[i];</span><br><span class="line">      <span class="keyword">let</span> variableDeclarator = &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;VariableDeclarator&#x27;</span>,</span><br><span class="line">        <span class="attr">id</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;Identifier&#x27;</span>, <span class="attr">name</span>: curToken.<span class="property">value</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      i += <span class="number">2</span>;</span><br><span class="line">      curToken = tokens[i];</span><br><span class="line">      <span class="keyword">if</span> (curToken.<span class="property">type</span> === <span class="string">&#x27;String&#x27;</span>) &#123;</span><br><span class="line">        variableDeclarator.<span class="property">init</span> = &#123; <span class="attr">type</span>: <span class="string">&#x27;StringLiteral&#x27;</span>, <span class="attr">value</span>: curToken.<span class="property">value</span> &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (curToken.<span class="property">type</span> === <span class="string">&#x27;JSXElement&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// JSX</span></span><br><span class="line">        <span class="keyword">let</span> value = curToken.<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">let</span> [, type, children] = value.<span class="title function_">match</span>(<span class="regexp">/&lt;([^&gt;]+?)&gt;([^&lt;]+)&lt;\/\1&gt;/</span>);</span><br><span class="line">        variableDeclarator.<span class="property">init</span> = &#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;JSXElement&#x27;</span>,</span><br><span class="line">          <span class="attr">openingElement</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;OpeningElement&#x27;</span>,</span><br><span class="line">            <span class="attr">name</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;JSXIdentifier&#x27;</span>, <span class="attr">name</span>: type &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">closingElement</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;ClosingElement&#x27;</span>,</span><br><span class="line">            <span class="attr">name</span>: &#123; <span class="attr">name</span>: type&#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">children</span>: [</span><br><span class="line">            &#123; <span class="attr">type</span>: <span class="string">&#x27;JSXText&#x27;</span>, <span class="attr">value</span>: children &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">VariableDeclaration</span>.<span class="property">declarations</span>.<span class="title function_">push</span>(variableDeclarator);</span><br><span class="line">    &#125;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ast</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个tokens 的结果，就是3.js拆词得到的结果</span></span><br><span class="line"><span class="keyword">let</span> tokens = [</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;Keyword&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;let&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;WhiteSpace&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27; &#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;Identifier&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;element&#x27;</span> &#125;,</span><br><span class="line">  <span class="comment">// &#123; type: &#x27;WhiteSpace&#x27;, value: &#x27; &#x27; &#125;,</span></span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;Equal&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;=&#x27;</span> &#125;,</span><br><span class="line">  <span class="comment">// &#123; type: &#x27;WhiteSpace&#x27;, value: &#x27; &#x27; &#125;,</span></span><br><span class="line">  &#123; <span class="attr">type</span>: <span class="string">&#x27;JSXElement&#x27;</span>, <span class="attr">value</span>: <span class="string">&#x27;&lt;h1&gt;hello&lt;/h1&gt;&#x27;</span> &#125;</span><br><span class="line">  <span class="comment">// &#123; type: &#x27;String&#x27;, value: &#x27;hello&#x27; &#125;</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">let</span> ast = <span class="title function_">parse</span>(tokens);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(ast));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  &quot;type&quot;:&quot;Program&quot;,</span></span><br><span class="line"><span class="comment">  &quot;body&quot;:[</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      &quot;type&quot;:&quot;VariableDeclaration&quot;,</span></span><br><span class="line"><span class="comment">      &quot;declarations&quot;:[</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">          &quot;type&quot;:&quot;VariableDeclarator&quot;,</span></span><br><span class="line"><span class="comment">          &quot;id&quot;:&#123;&quot;type&quot;:&quot;Identifier&quot;,&quot;name&quot;:&quot;element&quot;&#125;,</span></span><br><span class="line"><span class="comment">          &quot;init&quot;:&#123;</span></span><br><span class="line"><span class="comment">            &quot;type&quot;:&quot;JSXElement&quot;,</span></span><br><span class="line"><span class="comment">            &quot;openingElement&quot;:&#123;</span></span><br><span class="line"><span class="comment">              &quot;type&quot;:&quot;OpeningElement&quot;,</span></span><br><span class="line"><span class="comment">              &quot;name&quot;:&#123;&quot;type&quot;:&quot;JSXIdentifier&quot;,&quot;name&quot;:&quot;h1&quot;&#125;</span></span><br><span class="line"><span class="comment">            &#125;,</span></span><br><span class="line"><span class="comment">            &quot;closingElement&quot;:&#123;</span></span><br><span class="line"><span class="comment">              &quot;type&quot;:&quot;ClosingElement&quot;,</span></span><br><span class="line"><span class="comment">              &quot;name&quot;:&#123;&quot;name&quot;:&quot;h1&quot;&#125;</span></span><br><span class="line"><span class="comment">            &#125;,</span></span><br><span class="line"><span class="comment">            &quot;children&quot;:[</span></span><br><span class="line"><span class="comment">              &#123;&quot;type&quot;:&quot;JSXText&quot;,&quot;value&quot;:&quot;hello&quot;&#125;</span></span><br><span class="line"><span class="comment">            ]</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">      ]</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  ],</span></span><br><span class="line"><span class="comment">  &quot;sourceType&quot;:&quot;module&quot;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2020-04-23-ast/" data-id="cl1fzqfw8000pvgnuacnwa42d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ast/" rel="tag">ast</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2020-04-27-dart" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2020-04-27-dart/" class="article-date">
  <time datetime="2022-03-29T02:49:29.885Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Dart/">Dart</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2020-04-27-dart/">Dart 入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>这个学习笔记写的很水，只为了初步了解flutter，所以语言方面没有深入学习，只学了基础的。</p>
<p>学习 Dart ，主要为了学习 flutter，代码太多，具体不贴了。链接如下</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/happychong/my_first_flutter_app">my_first_flutter_app</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/happychong/film_flutter_app">film_flutter_app</a></li>
</ul>
<ul>
<li>1.强类型编程语言,Dart之下一切皆对象</li>
<li>2.Dart 目前可用于全平台开发</li>
<li>3.Dart 是谷歌发布的面向对象的开源编程语言</li>
</ul>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li>Web开发</li>
<li>扩平台移动应用开发（Flutter）</li>
<li>脚本或服务端开发</li>
</ul>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var 定义变量不要求数据类型，表示泛型，但是对数据类型自动识别，</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="title function_">print</span>(a);</span><br><span class="line"><span class="comment">// var a = 10;  重复定义一个变量名，会报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义常量：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// final</span></span><br><span class="line"><span class="comment">// 1：定义与赋值一次完成，也就是定义的时候必须赋值</span></span><br><span class="line"><span class="comment">// 2：重新赋值会报错，不能重新复制</span></span><br><span class="line"><span class="comment">// 3：即可以是编译器常量，也可以是运行结果</span></span><br><span class="line">final b = <span class="number">10</span>;</span><br><span class="line"><span class="comment">// b = 3; // 报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const </span></span><br><span class="line"><span class="comment">// 1：定义与赋值一次完成，也就是定义的时候必须赋值</span></span><br><span class="line"><span class="comment">// 2：重新赋值会报错，不能重新复制</span></span><br><span class="line"><span class="comment">// 3：定义的是编译器的常量，不能是运行结果</span></span><br></pre></td></tr></table></figure>




<h2 id="flutter"><a href="#flutter" class="headerlink" title="flutter"></a>flutter</h2><p>statelessWidget - 无状态组件<br>StatefulWidget - 有状态组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个flutter应用，最基础的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入一个UI组件库</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="comment">// main 函数是入口函数   runApp 是系统提供的方法，就是执行渲染</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">main</span>() =&gt; <span class="title function_">runApp</span>(<span class="title class_">MyApp</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyApp</span> <span class="keyword">extends</span> <span class="title class_ inherited__">StatelessWidget</span> &#123;</span><br><span class="line">  <span class="comment">// override 意思就是覆盖   Widget 是组件类型，规定我们build函数的返回值类型 ，必须是一个组件</span></span><br><span class="line">  <span class="comment">// 每一个静态组件都需要一个build函数，用来做组件的渲染</span></span><br><span class="line">  @override</span><br><span class="line">  <span class="title class_">Widget</span> <span class="title function_">build</span>(<span class="params">BuildContext context</span>) &#123;</span><br><span class="line">    <span class="comment">// 每个项目最外成必须被MaterialApp包裹，里面有一些UI组件，包含了移动端页面渲染的一些相关规范</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">MaterialApp</span>(</span><br><span class="line">      <span class="comment">// title 每个页面都有一个title，不显示在页面上</span></span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      <span class="comment">// theme 设置当前项目的默认颜色</span></span><br><span class="line">      <span class="attr">theme</span>: <span class="title class_">ThemeData</span>(</span><br><span class="line">        <span class="attr">primarySwatch</span>: <span class="title class_">Colors</span>.<span class="property">blue</span>,</span><br><span class="line">      ),</span><br><span class="line">      <span class="attr">home</span>: <span class="title class_">HomePage</span>(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomePage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">StatefulWidget</span> &#123;</span><br><span class="line">  @override</span><br><span class="line">  _HomePageState <span class="title function_">createState</span>() =&gt; <span class="title function_">_HomePageState</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_HomePageState</span> <span class="keyword">extends</span> <span class="title class_ inherited__">State</span>&lt;<span class="title class_">HomePage</span>&gt; &#123;</span><br><span class="line">  @override</span><br><span class="line">  <span class="title class_">Widget</span> <span class="title function_">build</span>(<span class="params">BuildContext context</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Scaffold</span>(</span><br><span class="line">      <span class="comment">// appBar 头部导航组件</span></span><br><span class="line">      <span class="attr">appBar</span>: <span class="title class_">AppBar</span>(</span><br><span class="line">        <span class="comment">// title: Text(widget.title + &#x27; 000&#x27;),</span></span><br><span class="line">        <span class="attr">title</span>: <span class="title class_">Text</span>(<span class="string">&#x27;new Title&#x27;</span>)</span><br><span class="line">      ),</span><br><span class="line">      <span class="attr">body</span>: <span class="title class_">Center</span>(</span><br><span class="line">        <span class="attr">child</span>: <span class="title class_">Text</span>(<span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2020-04-27-dart/" data-id="cl1fzqfw9000qvgnuftr336xe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dart/" rel="tag">Dart</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2020-04-14-node进程（process）" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2020-04-14-node%E8%BF%9B%E7%A8%8B%EF%BC%88process%EF%BC%89/" class="article-date">
  <time datetime="2022-03-29T02:49:29.883Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Node/">Node</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2020-04-14-node%E8%BF%9B%E7%A8%8B%EF%BC%88process%EF%BC%89/">Node 的 进程 (process)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="1-进程-amp-线程"><a href="#1-进程-amp-线程" class="headerlink" title="1 进程 &amp; 线程"></a>1 进程 &amp; 线程</h2><ul>
<li>进程（process）是计算机中的程序，是系统进行资源分配和调度的基本单位，比如qq就是一个进程</li>
<li>线程（Thread）是操作系统能够进行运算调度的最小单位，被包含在进程之中，是进程中的实际运作单位，比如qq中可以做多个事</li>
</ul>
<h2 id="2-Node中的进程和线程"><a href="#2-Node中的进程和线程" class="headerlink" title="2 Node中的进程和线程"></a>2 Node中的进程和线程</h2><p>主线程是单线程的：一个进程只开一个主线程，基于事件驱动的、异步非阻塞I&#x2F;O，可以应用与高并发场景，Nodejs中没有多线程，为了充分利用多核cpu，可以使用子进程实现内核的负载均衡，不适合cup密集型，会导致其他请求会等待处理完成后再进行处理</p>
<h2 id="3-项目中我们要解决的问题"><a href="#3-项目中我们要解决的问题" class="headerlink" title="3 项目中我们要解决的问题"></a>3 项目中我们要解决的问题</h2><ul>
<li>Node.js 做耗时的计算时候阻塞问题</li>
<li>Node.js 如何开启多进程</li>
<li>开发过程中如何实现进程守护</li>
</ul>
<h2 id="4-创建子进程"><a href="#4-创建子进程" class="headerlink" title="4 创建子进程"></a>4 创建子进程</h2><h3 id="进程间-pipe-方式通信"><a href="#进程间-pipe-方式通信" class="headerlink" title="进程间 pipe 方式通信"></a>进程间 pipe 方式通信</h3><p>pipe 通信方式要监听事件，不方便</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.spawn.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// child_process 子进程模块，核心模块</span></span><br><span class="line"><span class="keyword">let</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>); <span class="comment">// spawn: 产卵</span></span><br><span class="line"><span class="comment">// 创建子进程，执行test下的a.js</span></span><br><span class="line"><span class="keyword">let</span> cp = <span class="title function_">spawn</span>(<span class="string">&#x27;node&#x27;</span>, [<span class="string">&#x27;a.js&#x27;</span>], &#123;</span><br><span class="line">  <span class="attr">cwd</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;test&#x27;</span>),</span><br><span class="line">  <span class="comment">// stdio: &#x27;ignore&#x27; // 忽略子进程中的输出</span></span><br><span class="line">    <span class="comment">// process.stdin:标准输入（0）   process.stdout：标准输出（1）    process.stderr：错误输出（2）     stdio: [0, 1, 2](默认)</span></span><br><span class="line">  <span class="comment">// stdio: [process.stdin, process.stdout, process.stderr]  // 子进程共享父进程中的输入输出  这样的方式只能打印一些日志</span></span><br><span class="line">  <span class="attr">stdio</span>: <span class="string">&#x27;pipe&#x27;</span> <span class="comment">// 子进程和父进程都是通过pipe通信    &#x27;pipe&#x27; = [&#x27;pipe&#x27;, &#x27;pipe&#x27;, &#x27;pipe&#x27;]</span></span><br><span class="line">&#125;);</span><br><span class="line">cp.<span class="property">stdout</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="comment">// 这里的stdout，要和子进程中的stdout对应上，还可以是stdin | stderr</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data + <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">cp.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">&#125;);</span><br><span class="line">cp.<span class="title function_">on</span>(<span class="string">&#x27;close&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;close&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">cp.<span class="title function_">on</span>(<span class="string">&#x27;exit&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;exit&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /test/a.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  total += i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(total);</span></span><br><span class="line">process.<span class="property">stdout</span>.<span class="title function_">write</span>(total + <span class="string">&#x27;&#x27;</span>); <span class="comment">// write的参数只能是 String or Bugger</span></span><br></pre></td></tr></table></figure>

<h3 id="进程间-ipc-方式通信"><a href="#进程间-ipc-方式通信" class="headerlink" title="进程间 ipc 方式通信"></a>进程间 ipc 方式通信</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.ipc.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// child_process 子进程模块，核心模块</span></span><br><span class="line"><span class="keyword">let</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>); <span class="comment">// spawn: 产卵</span></span><br><span class="line"><span class="comment">// 创建子进程，执行test下的a.js</span></span><br><span class="line"><span class="keyword">let</span> cp = <span class="title function_">spawn</span>(<span class="string">&#x27;node&#x27;</span>, [<span class="string">&#x27;b.js&#x27;</span>], &#123;</span><br><span class="line">  <span class="attr">cwd</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;test&#x27;</span>),</span><br><span class="line">  <span class="attr">stdio</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;ipc&#x27;</span>] <span class="comment">// ipc: 通过 message 和 send 方法进行通信，类似webworder   这里的设置不能只包括ipc</span></span><br><span class="line">&#125;);</span><br><span class="line">cp.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 主进程给子进程发送消息</span></span><br><span class="line">cp.<span class="title function_">send</span>(<span class="string">&#x27;我是主进程send的消息&#x27;</span>);</span><br><span class="line"><span class="comment">// cp.kill(); // 杀掉子进程，但是杀掉监听message就拿不到消息了，所以注释掉</span></span><br><span class="line"><span class="comment">// 子进程要听从父进程，父进程kill掉，子进程会自动关闭</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /test/b.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  total += i;</span><br><span class="line">&#125;</span><br><span class="line">process.<span class="title function_">send</span>(total);</span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child log：&#x27;</span>, data, process.<span class="property">pid</span>);</span><br><span class="line">  <span class="comment">// 接收到消息后，子进程退出</span></span><br><span class="line">  process.<span class="title function_">exit</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="解除主子进程关系的-ipc-通信"><a href="#解除主子进程关系的-ipc-通信" class="headerlink" title="解除主子进程关系的 ipc 通信"></a>解除主子进程关系的 ipc 通信</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.ipc.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="comment">// ex：爬虫 不定期的从别的网站上获取数据，再展示给客户端，，可以一直启动着，主子之间没有关系，主线程挂了，子进程可以接着爬</span></span><br><span class="line"><span class="keyword">let</span> cp = <span class="title function_">spawn</span>(<span class="string">&#x27;node&#x27;</span>, [<span class="string">&#x27;c.js&#x27;</span>], &#123;</span><br><span class="line">  <span class="attr">cwd</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;test&#x27;</span>),</span><br><span class="line">  <span class="attr">stdio</span>: <span class="string">&#x27;ignore&#x27;</span>, <span class="comment">// 忽略子进程中的输出， 主子之间不传递消息了</span></span><br><span class="line">  <span class="attr">detached</span>: <span class="literal">true</span> <span class="comment">// detached：独立的</span></span><br><span class="line">&#125;);</span><br><span class="line">cp.<span class="title function_">unref</span>(); <span class="comment">// 父进程放弃子进程控制，让子进程自己跑</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cp.<span class="property">pid</span>); <span class="comment">// 获取子进程的id号</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /test/c.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">  total += i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  fs.<span class="title function_">appendFileSync</span>(<span class="string">&#x27;1.txt&#x27;</span>, <span class="string">&#x27;zf&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<h2 id="5-httpServer-中应用子进程-示例"><a href="#5-httpServer-中应用子进程-示例" class="headerlink" title="5 httpServer 中应用子进程 示例"></a>5 httpServer 中应用子进程 示例</h2><h3 id="ipc-方式示例"><a href="#ipc-方式示例" class="headerlink" title="ipc 方式示例"></a>ipc 方式示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.server.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; spawn &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/sum&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果有个/sum请求，代码在这里计算，之后又有个其他接口请求，代码会/sum计算完成后，再处理其他接口，单线程阻塞了</span></span><br><span class="line">    <span class="comment">// let total = 0;</span></span><br><span class="line">    <span class="comment">// for (let i = 0; i &lt; 10000000000; i++) &#123;</span></span><br><span class="line">    <span class="comment">//   total += i;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// res.end(total);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开启子进程单独处理计算问题，不阻塞其他接口请求的处理</span></span><br><span class="line">    <span class="keyword">let</span> cp = <span class="title function_">spawn</span>(<span class="string">&#x27;node&#x27;</span>, [<span class="string">&#x27;sum.js&#x27;</span>], &#123;</span><br><span class="line">      <span class="attr">cwd</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;test&#x27;</span>),</span><br><span class="line">      <span class="attr">stdio</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;ipc&#x27;</span>] <span class="comment">// 内容少可以用 ipc 方式，内容多可以用pipe</span></span><br><span class="line">    &#125;);</span><br><span class="line">    cp.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&#x27;tatal:&#x27;</span> + data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;end ok&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sum.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> total = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000000</span>; i++) &#123;</span><br><span class="line">  total += i;</span><br><span class="line">&#125;</span><br><span class="line">process.<span class="title function_">send</span>(total);</span><br></pre></td></tr></table></figure>

<h3 id="fork-方式示例"><a href="#fork-方式示例" class="headerlink" title="fork 方式示例"></a>fork 方式示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.fork.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>); <span class="comment">// fork:复制，克隆</span></span><br><span class="line"><span class="comment">// fork 就是封装了 spawn，可以少设置一些参数，使用方便一些，如果只执行某个文件，可以直接用fork</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&#x27;/sum&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// fork默认会加node属性</span></span><br><span class="line">    <span class="keyword">let</span> cp = <span class="title function_">fork</span>(<span class="string">&#x27;sum.js&#x27;</span>, &#123;</span><br><span class="line">      <span class="attr">cwd</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">    cp.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&#x27;tatal:&#x27;</span> + data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;end ok&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="其他子进程方式"><a href="#其他子进程方式" class="headerlink" title="其他子进程方式"></a>其他子进程方式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; fork, execFile, exec &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// spawn 可以应用pipe读取大文件</span></span><br><span class="line"><span class="comment">// fork 可以使用ipc   - 如果执行node脚本，而且需要获取内容，可以使用fork</span></span><br><span class="line"><span class="comment">// execFile 功能是执行命令 核心也基于spawn，  把结果都整合好，触发回调函数，默认数据最大200k </span></span><br><span class="line"><span class="comment">//  - 如果执行命令，用exec</span></span><br><span class="line"><span class="title function_">execFile</span>(<span class="string">&#x27;ls&#x27;</span>, [<span class="string">&#x27;-ll&#x27;</span>], <span class="function">(<span class="params">err, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 读取文件夹信息</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(stdout);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 与 execFile 相比，命令可以写一个字符串里了  默认exec会启动一个shell窗口执行命令</span></span><br><span class="line"><span class="title function_">exec</span>(<span class="string">&#x27;ls -ll&#x27;</span>, <span class="function">(<span class="params">err, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(stdout);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2020-04-14-node%E8%BF%9B%E7%A8%8B%EF%BC%88process%EF%BC%89/" data-id="cl1fzqfw5000nvgnu23975fvh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/process/" rel="tag">process</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2020-04-21-node进程（pm2）" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2020-04-21-node%E8%BF%9B%E7%A8%8B%EF%BC%88pm2%EF%BC%89/" class="article-date">
  <time datetime="2022-03-29T02:49:29.883Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Node/">Node</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2020-04-21-node%E8%BF%9B%E7%A8%8B%EF%BC%88pm2%EF%BC%89/">Node 的 进程(pm2)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="1-child-process-fork-方式实现多进程监听同一服务"><a href="#1-child-process-fork-方式实现多进程监听同一服务" class="headerlink" title="1 child_process - fork 方式实现多进程监听同一服务"></a>1 child_process - fork 方式实现多进程监听同一服务</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.process-cluster.js  主进程</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="comment">// os 系统包   cpus().length 拿到cup数量</span></span><br><span class="line"><span class="keyword">const</span> cpus = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).<span class="title function_">cpus</span>().<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 希望 开启多个进程 监听同一个服务</span></span><br><span class="line"><span class="comment">// fork 不是开的越多越好，数量和cpu数相同</span></span><br><span class="line"><span class="comment">// 一个服务 可以启动在不用的cpu上，但是必须监听同一个端口</span></span><br><span class="line"><span class="keyword">let</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100000000</span>; i++) &#123;</span><br><span class="line">    num = num + i;</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;parent:&#x27;</span> + process.<span class="property">pid</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`主线程pid：`</span>, process.<span class="property">pid</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cpus; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> child = <span class="title function_">fork</span>(<span class="string">&#x27;server.js&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">cwd</span>: __dirname</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// server 名字固定，就是传入一个http服务</span></span><br><span class="line">  child.<span class="title function_">send</span>(<span class="string">&#x27;server&#x27;</span>, server);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当前一共启动了4（cpu数）个服务，访问 http://localhost:3000/ 会由不同的服务来处理请求（集群-每个人做的都是同一件事）</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line">process.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span> (<span class="params">data, server</span>) &#123;</span><br><span class="line">  <span class="comment">// 所有人共用了 同一个端口号 server就是主进程中创建的server</span></span><br><span class="line">  http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000000</span>; i++) &#123;</span><br><span class="line">      num = num + i;</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;process:&#x27;</span> + process.<span class="property">pid</span>);</span><br><span class="line">  &#125;).<span class="title function_">listen</span>(server);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`server start`</span>, process.<span class="property">pid</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="2-cluster-方式实现多进程监听同一服务"><a href="#2-cluster-方式实现多进程监听同一服务" class="headerlink" title="2 cluster 方式实现多进程监听同一服务"></a>2 cluster 方式实现多进程监听同一服务</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.cluster-server.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// cluster（族） node内置模块</span></span><br><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">&#x27;cluster&#x27;</span>);</span><br><span class="line"><span class="comment">// cluster提供了fork方法</span></span><br><span class="line"><span class="keyword">const</span> cpus = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在集群的模式下 可以监听同一个端口号</span></span><br><span class="line"><span class="keyword">if</span> (cluster.<span class="property">isMaster</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;主&#x27;</span>);</span><br><span class="line">  cluster.<span class="title function_">on</span>(<span class="string">&#x27;exit&#x27;</span>, <span class="keyword">function</span> (<span class="params">worker</span>) &#123;</span><br><span class="line">    <span class="comment">// 主进程作用，还要守护进程，某个子进程挂了，要重启，保证项目的健壮性</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(worker.<span class="property">process</span>.<span class="property">pid</span>);</span><br><span class="line">    cluster.<span class="title function_">fork</span>();</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cpus; i++) &#123;</span><br><span class="line">    <span class="comment">// fork可以开启子进程，fork执行后会将此文件重新执行，此文件再次执行的时候 cluster.isMaster 为false，就走else逻辑了</span></span><br><span class="line">    cluster.<span class="title function_">fork</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 负载均衡</span></span><br><span class="line">  http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// if (Math.random() &gt; 0.5) &#123;</span></span><br><span class="line">    <span class="comment">//   // 模拟服务器挂掉，然后看重启效果</span></span><br><span class="line">    <span class="comment">//   aa();</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;process:&#x27;</span> + process.<span class="property">pid</span>);</span><br><span class="line">  &#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;分：&#x27;</span>, process.<span class="property">pid</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-pm2-方式实现多进程监听同一服务"><a href="#2-pm2-方式实现多进程监听同一服务" class="headerlink" title="2 pm2 方式实现多进程监听同一服务"></a>2 pm2 方式实现多进程监听同一服务</h2><p>一般线上部署时候，用docker + pm2</p>
<h3 id="pm2-基本命令"><a href="#pm2-基本命令" class="headerlink" title="pm2 基本命令"></a>pm2 基本命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install pm2 -g</span><br><span class="line"></span><br><span class="line"><span class="comment"># pm2 常用命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动进程</span></span><br><span class="line">pm2 start 2.pm2-server.js --name myname --watch -i max</span><br><span class="line"><span class="comment"># --name 取名</span></span><br><span class="line"><span class="comment"># --watch 监控变化 改代码保存会重启 这功能像nodemon</span></span><br><span class="line"><span class="comment"># -i 负载均衡    max(自动分配cpu)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行npm命令 参数为 run dev    并且守护它（restart - 重启）</span></span><br><span class="line">pm2 restart npm -- run dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示进程状态</span></span><br><span class="line">pm2 list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 杀死全部进程</span></span><br><span class="line">pm2 <span class="built_in">kill</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看日志</span></span><br><span class="line">pm2 <span class="built_in">log</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止 npm（name）   3（id）</span></span><br><span class="line">pm2 stop npm</span><br><span class="line">pm2 stop 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 npm（name）</span></span><br><span class="line">pm2 delete npm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出配置文件(ecosystem.config.js)</span></span><br><span class="line">pm2 ecosystem</span><br><span class="line"><span class="comment"># 有了配置文件以后，启动的时候 pm2 start ... 后面就不用跟一大坨配置了</span></span><br><span class="line"><span class="comment"># pm2 start（直接找 ecosystem.config.js的配置 进行启动）</span></span><br><span class="line"><span class="comment"># pm2 start xx.config.js (可以指定配置文件启动)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布、部署服务器 （执行此命令之前，要提前提交本地文件夹内容</span></span><br><span class="line">pm2 deploy ecosystem.config.js production [setup]</span><br><span class="line"><span class="comment"># setup 第一次部署的时候，要setup一下，表示把当前的git项目拉去到服务器上，如果加了setup，那还要再执行一下不加setup的命令，才能实现发布</span></span><br></pre></td></tr></table></figure>

<h3 id="项目代码"><a href="#项目代码" class="headerlink" title="项目代码"></a>项目代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.pm2-server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;process:&#x27;</span> + process.<span class="property">pid</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ecosystem.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  apps : [&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;myApp&#x27;</span>,</span><br><span class="line">    <span class="attr">script</span>: <span class="string">&#x27;2.pm2-server.js&#x27;</span>, <span class="comment">// 要执行的文件</span></span><br><span class="line">    <span class="attr">args</span>: <span class="string">&#x27;one two&#x27;</span>, <span class="comment">// node XXX one two</span></span><br><span class="line">    <span class="attr">instances</span>: <span class="number">4</span>, <span class="comment">// 实例个数</span></span><br><span class="line">    <span class="attr">autorestart</span>: <span class="literal">true</span>, <span class="comment">// 是否改完代码保存之后要重启</span></span><br><span class="line">    <span class="attr">watch</span>: <span class="string">&#x27;.&#x27;</span>, <span class="comment">// 监控  默认是 false</span></span><br><span class="line">    <span class="attr">max_memory_restart</span>: <span class="string">&#x27;10&#x27;</span>, <span class="comment">// 重启内存最大 1g</span></span><br><span class="line">    <span class="attr">env</span>: &#123;</span><br><span class="line">      <span class="attr">NODE_ENV</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">env_production</span>: &#123; <span class="comment">// 配置环境变量</span></span><br><span class="line">      <span class="attr">NODE_ENV</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="comment">// pm2 可以搬我们实现自动发布 ， 可以和git一同使用</span></span><br><span class="line">  deploy : &#123;</span><br><span class="line">    production : &#123;</span><br><span class="line">      user : <span class="string">&#x27;SSH_USERNAME&#x27;</span>, <span class="comment">// 买的服务器的用户名</span></span><br><span class="line">      host : <span class="string">&#x27;SSH_HOSTMACHINE&#x27;</span>, <span class="comment">// 服务器的主机名</span></span><br><span class="line">      ref  : <span class="string">&#x27;origin/master&#x27;</span>, <span class="comment">// 分支</span></span><br><span class="line">      repo : <span class="string">&#x27;GIT_REPOSITORY&#x27;</span>, <span class="comment">// 仓库地址 可以ssh-免密的，也可以https-加密的</span></span><br><span class="line">      path : <span class="string">&#x27;DESTINATION_PATH&#x27;</span>, <span class="comment">// 部署到服务器哪个目录下</span></span><br><span class="line">      <span class="string">&#x27;pre-deploy-local&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="comment">// 进到目录下 执行npm install 并且 重启当前的配置文件 且配置好环境变量（条件是服务器上要安装好了pm2）</span></span><br><span class="line">      <span class="string">&#x27;post-deploy&#x27;</span> : <span class="string">&#x27;npm install &amp;&amp; pm2 reload ecosystem.config.js --env production&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;pre-setup&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>现在pm2 的配置也设置好了，项目代码也准备好了，接下来执行 pm2 deploy 相关命令，就可以把 git 代码拷贝到服务器上，并且在服务器上启服务了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2020-04-21-node%E8%BF%9B%E7%A8%8B%EF%BC%88pm2%EF%BC%89/" data-id="cl1fzqfw7000ovgnu4vnrezi7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pm2/" rel="tag">pm2</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2020-03-30-webpack源码编译流程" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2020-03-30-webpack%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/" class="article-date">
  <time datetime="2022-03-29T02:49:29.882Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%A8%E8%BE%B9/">周边</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2020-03-30-webpack%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/">webpack - 源码编译流程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="webpack编译流程"><a href="#webpack编译流程" class="headerlink" title="webpack编译流程"></a>webpack编译流程</h2><ul>
<li>初始化参数：合并配置文件（一般为webpack.config.js)的参数和命令行的参数</li>
<li>开始编译：用上一步得到的参数初始化Compiler对象，加载需要的拆件，执行对象的run方法开始执行编译，找到入口文件</li>
<li>编译模块：从入口文件出发，调用所有配置的loader对模块进行编译，再找出该模块依赖的模块，递归本步骤直到所有入口依赖的文件都经过了本步骤的处理</li>
<li>完成模块编译：得到每个模块被翻译后的最终内容以及它们之间的依赖关系</li>
<li>输出资源：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的Chunk，再把每个Chunk转换成一个单独的文件加入道输出列表</li>
<li>输出完成：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统</li>
</ul>
<h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><p><img src="/images/webpack%E6%89%93%E5%8C%85%E5%8E%9F%E7%90%86%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="webpack打包原理流程图"></p>
<h2 id="代码内容好多，直接贴源码地址吧"><a href="#代码内容好多，直接贴源码地址吧" class="headerlink" title="代码内容好多，直接贴源码地址吧"></a>代码内容好多，直接贴源码地址吧</h2><p><a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/tree/master/10.myWebpack/4-webpack-core">源码地址</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2020-03-30-webpack%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/" data-id="cl1fzqfw0000mvgnu0fmdflmx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2019-12-20-webpack优化" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2019-12-20-webpack%E4%BC%98%E5%8C%96/" class="article-date">
  <time datetime="2022-03-29T02:49:29.882Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%A8%E8%BE%B9/">周边</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2019-12-20-webpack%E4%BC%98%E5%8C%96/">webpack 4.0 + 笔记(优化)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>代码地址：<a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/tree/master/9.webpack">https://github.com/happychong/2019-zhufeng/tree/master/9.webpack</a></p>
<p>查看此文档打包前提：</p>
<ol>
<li>webpack.base.js 中 entry 设置为 index-optimize.js</li>
<li>.babelrc -&gt; presets -&gt; @babel&#x2F;preset-typescript 关于 typescript 的部分设置注释掉</li>
</ol>
<h2 id="一：删除无用css代码"><a href="#一：删除无用css代码" class="headerlink" title="一：删除无用css代码"></a>一：删除无用css代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装包</span></span><br><span class="line">npm install purgecss-webpack-plugin glob --save-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">&#x27;glob&#x27;</span>); <span class="comment">// 查找匹配的文件</span></span><br><span class="line"><span class="comment">// 删除无意义的css，只能配合mini-css-extract-plugin</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PurgeCssWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;purgecss-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="comment">// 配置对象</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">PurgeCssWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="comment">// glob.sync: 返回包含 src 目录下所有（深层）文件的文件名的数组, nodir-不包含目录名</span></span><br><span class="line">            <span class="attr">paths</span>: glob.<span class="title function_">sync</span>(<span class="string">&quot;./src/**/*&quot;</span>, &#123; <span class="attr">nodir</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二：图片压缩-image-webpack-loader"><a href="#二：图片压缩-image-webpack-loader" class="headerlink" title="二：图片压缩  image-webpack-loader"></a>二：图片压缩  image-webpack-loader</h2><p>必须要和 file-loader 一起使用，相当于先优化再拷贝</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装包</span></span><br><span class="line">npm install image-webpack-loader --save-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [&#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|png|gif)$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 希望当前比较小的图片转化为 base64 ，转化后尺寸比以前大，但是不用发http请求了</span></span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="comment">// 大于 100k 的图片，会用 file-loader</span></span><br><span class="line">                        <span class="attr">limit</span>: <span class="number">8</span> * <span class="number">1024</span>, <span class="comment">// 一般为 8*1024</span></span><br><span class="line">                        <span class="comment">// 打包到目录下</span></span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;image/[contentHash].[ext]&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                (!isDev) &amp;&amp; &#123;</span><br><span class="line">                    <span class="comment">// 可以在使用file-loader之前 对图片进行压缩</span></span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;image-webpack-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="comment">// jpeg格式</span></span><br><span class="line">                        <span class="attr">mozjpeg</span>: &#123;</span><br><span class="line">                            <span class="attr">progressive</span>: <span class="literal">true</span>,</span><br><span class="line">                            <span class="attr">quality</span>: <span class="number">65</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="comment">// optipng.enabled: false will disable optipng</span></span><br><span class="line">                        <span class="comment">// 是否禁用png压缩：不禁用</span></span><br><span class="line">                        <span class="attr">optipng</span>: &#123;</span><br><span class="line">                            <span class="attr">enabled</span>: <span class="literal">false</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="comment">// png格式</span></span><br><span class="line">                        <span class="attr">pngquant</span>: &#123;</span><br><span class="line">                            <span class="comment">// 清晰度 64% - 90% 之间</span></span><br><span class="line">                            <span class="attr">quality</span>: [<span class="number">0.65</span>, <span class="number">0.90</span>],</span><br><span class="line">                            <span class="attr">speed</span>: <span class="number">4</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="comment">// gif格式</span></span><br><span class="line">                        <span class="attr">gifsicle</span>: &#123;</span><br><span class="line">                            <span class="attr">interlaced</span>: <span class="literal">false</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="comment">// the webp option will enable WEBP</span></span><br><span class="line">                        <span class="comment">// bp格式</span></span><br><span class="line">                        <span class="attr">webp</span>: &#123;</span><br><span class="line">                            <span class="attr">quality</span>: <span class="number">75</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>)</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三：cdn-资源"><a href="#三：cdn-资源" class="headerlink" title="三：cdn 资源"></a>三：cdn 资源</h2><h3 id="externals设置外部变量"><a href="#externals设置外部变量" class="headerlink" title="externals设置外部变量"></a>externals设置外部变量</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这样引入cdn资源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;react-root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;ts-react-root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">externals</span>: &#123;</span><br><span class="line">        <span class="comment">// 代码中，import $ 的时候，使用 $ 的时候，是外部变量，不需要被打包</span></span><br><span class="line">        <span class="string">&#x27;jquery&#x27;</span>: <span class="string">&#x27;$&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="add-asset-html-cdn-webpack-plugin-添加html资源作为cdn的webpack插件"><a href="#add-asset-html-cdn-webpack-plugin-添加html资源作为cdn的webpack插件" class="headerlink" title="add-asset-html-cdn-webpack-plugin 添加html资源作为cdn的webpack插件"></a>add-asset-html-cdn-webpack-plugin 添加html资源作为cdn的webpack插件</h3><p>但是如果需要cdn资源比较多，那么html文件中的script标签就会比较多，不方便，所以用  插件维护cdn资源引入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装包</span></span><br><span class="line">npm i --save-dev add-asset-html-cdn-webpack-plugin</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line"><span class="comment">// 用add-asset-html-cdn-webpack-plugin的话，注释掉上面设置的externals和html中的script标签部分</span></span><br><span class="line"><span class="comment">// js管理cdn资源引入插件 添加html资源作为cdn的webpack插件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AddAssetHtmlCdnWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;add-asset-html-cdn-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">AddAssetHtmlCdnWebpackPlugin</span>(<span class="literal">true</span>, &#123;</span><br><span class="line">            <span class="string">&#x27;jquery&#x27;</span>: <span class="string">&#x27;https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四：tree-shaking-去掉没用的代码，只支持es6模块（webpack内置功能）"><a href="#四：tree-shaking-去掉没用的代码，只支持es6模块（webpack内置功能）" class="headerlink" title="四：tree-shaking 去掉没用的代码，只支持es6模块（webpack内置功能）"></a>四：tree-shaking 去掉没用的代码，只支持es6模块（webpack内置功能）</h2><p>去掉没用的代码，只支持es6模块,因为es6是静态导入，可以在使用之前分析用到哪些</p>
<p>只在生产模式下有效</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index-optimize.js</span></span><br><span class="line"><span class="comment">// calc中导出add 和 minus方法，但是这里只用了minus</span></span><br><span class="line"><span class="comment">// 那么npm run dev 打包包括2个方法，npm run build 只包括minus方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; minus &#125; <span class="keyword">from</span> <span class="string">&#x27;./calc&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">minus</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>

<h2 id="五：sideEffects-是否应用副作用代码-生产模式有效"><a href="#五：sideEffects-是否应用副作用代码-生产模式有效" class="headerlink" title="五：sideEffects - 是否应用副作用代码(生产模式有效)"></a>五：sideEffects - 是否应用副作用代码(生产模式有效)</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;<span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span>&#125;</span><br><span class="line"><span class="comment">// 模块内部执行test</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">test</span>());</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> test;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index-optimize.js</span></span><br><span class="line"><span class="keyword">import</span> test <span class="keyword">from</span> <span class="string">&#x27;./test&#x27;</span>;</span><br><span class="line"><span class="comment">// 只引用test模块，并没有应用</span></span><br></pre></td></tr></table></figure>

<p>以上情况下，webpack认为代码应该保留test的代码</p>
<p>但是实际上我们认为test模块被引入，但是引入test的模块并没有应用test模块，test这样的副作用的代码，是无意义的，打包时需要被删除掉</p>
<p>我们想打包的时候删除这样的副作用代码，需要手动在package.json中设置 sideEffects: false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 是否应用副作用</span></span><br><span class="line">    <span class="string">&quot;sideEffects&quot;</span>: <span class="literal">false</span></span><br><span class="line">    <span class="comment">// 但是这样设置之后也会有额外的影响，比如直接引入样式，生产打包的时候会被忽略掉</span></span><br><span class="line">    <span class="comment">// 所以用下面的设置方法</span></span><br><span class="line">    <span class="string">&quot;sideEffects&quot;</span>: [</span><br><span class="line">        <span class="comment">// css文件，不是副作用</span></span><br><span class="line">        <span class="string">&quot;**/*.css&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六：Scope-Hoisting-减少作用域-并计算-（只生产模式下有效）（webpack内置功能）"><a href="#六：Scope-Hoisting-减少作用域-并计算-（只生产模式下有效）（webpack内置功能）" class="headerlink" title="六：Scope-Hoisting - 减少作用域 | 并计算 （只生产模式下有效）（webpack内置功能）"></a>六：Scope-Hoisting - 减少作用域 | 并计算 （只生产模式下有效）（webpack内置功能）</h2><p>每个模块都是一个函数，函数太多会导致内存过大</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scope-Hoisting.js</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">let</span> c = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">let</span> d = a + b + c;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> d;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index-optimize.js</span></span><br><span class="line"><span class="keyword">import</span> d <span class="keyword">from</span> <span class="string">&#x27;./scope-Hoisting&#x27;</span>;</span><br><span class="line"><span class="comment">// 导出d，打包后导出的是一个函数（消耗内存），如下</span></span><br><span class="line"><span class="comment">// (function () &#123;</span></span><br><span class="line"><span class="comment">//     return 6</span></span><br><span class="line"><span class="comment">// &#125;)()</span></span><br><span class="line"><span class="comment">// Scope-Hoisting 会 直接导出数值6，节省内存，webpack4之后，不需要配置</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d);</span><br></pre></td></tr></table></figure>

<h2 id="七：dllPlugin-动态链接库-：-打包库（主要开发模式应用）"><a href="#七：dllPlugin-动态链接库-：-打包库（主要开发模式应用）" class="headerlink" title="七：dllPlugin - 动态链接库 ： 打包库（主要开发模式应用）"></a>七：dllPlugin - 动态链接库 ： 打包库（主要开发模式应用）</h2><p>背景1：开发模式下，每次保存代码就重新打包，每次打包都要打包react 和 react-dom 库内容，性能不高</p>
<p>背景2：生产模式，需要单独打包第三方模块，例如react，vue等</p>
<p>解决以上问题想法（dll功能）：我们可以在开发之前，就先打包（抽离）好，以后就不用再打包了(一般用于开发环境)</p>
<p>ex：先把 react 和 react-dom 单独打包好，放在那，用manifest.json（缓存文件）配置好，当查找 node_modules 下的 react 和 react-dom 的时候，就从manifest.json里的配置读取，这样每次打包的时候，就不再重新打包 react 和 react-dom 了，节省了打包时间，增加了打包效率</p>
<h3 id="首先配置好dll的打包语句，执行build-x2F-webpack-dll-js"><a href="#首先配置好dll的打包语句，执行build-x2F-webpack-dll-js" class="headerlink" title="首先配置好dll的打包语句，执行build&#x2F;webpack.dll.js"></a>首先配置好dll的打包语句，执行build&#x2F;webpack.dll.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;dll&quot;</span>: <span class="string">&quot;webpack --config ./build/webpack.dll.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第二步：配置打包第三方库的-webpack-dll-js-文件"><a href="#第二步：配置打包第三方库的-webpack-dll-js-文件" class="headerlink" title="第二步：配置打包第三方库的 webpack.dll.js 文件"></a>第二步：配置打包第三方库的 webpack.dll.js 文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dll.js 打包公共模块的webpack配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DLLPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>).<span class="property">DllPlugin</span>;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="comment">// 关于calc.js注释的代码：目前是为了将calc打包成node可以使用的模块</span></span><br><span class="line">    <span class="comment">// entry: &#x27;./src/calc.js&#x27;, // 其中包含 add &amp; minus</span></span><br><span class="line">    <span class="attr">entry</span>: [<span class="string">&#x27;react&#x27;</span>, <span class="string">&#x27;react-dom&#x27;</span>], <span class="comment">// 把第三方模块react和react-dom一起打包</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// 打包后，接受自执行函数的名字</span></span><br><span class="line">        <span class="attr">library</span>: <span class="string">&#x27;react&#x27;</span>,</span><br><span class="line">        <span class="comment">// 默认用var 模式： commonjs commonjs2 umd（amd+cmd+commonjs） this ,</span></span><br><span class="line">        <span class="comment">// 一般node用commonjs2,如果只是想接收一下变量，libraryTarget可以不设置，用全局的方式接收</span></span><br><span class="line">        <span class="attr">libraryTarget</span>: <span class="string">&#x27;var&#x27;</span>,</span><br><span class="line">        <span class="comment">// 打包后的名字</span></span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;react.dll.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../dll&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 生成manifest.json（名字可任意）配置文件</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DLLPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;react&#x27;</span>,</span><br><span class="line">            <span class="comment">// manifest.json 中，会把我们打包的react.dll.js中用到的所有模块都列出</span></span><br><span class="line">            <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../dll/manifest.json&#x27;</span>)</span><br><span class="line">            <span class="comment">// 打包的时候 会配置cleanwebpackgplgin,所以不放在dist里，否则每次打包都被删除了</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第三步：还需要把打包好的第三方库引入到-html-中，并且设置好读取"><a href="#第三步：还需要把打包好的第三方库引入到-html-中，并且设置好读取" class="headerlink" title="第三步：还需要把打包好的第三方库引入到 html 中，并且设置好读取"></a>第三步：还需要把打包好的第三方库引入到 html 中，并且设置好读取</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件： webpack.base.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">// 引用打包好的第三方库</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DllReferencePlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>).<span class="property">DllReferencePlugin</span>;</span><br><span class="line"><span class="comment">// 把打包好的第三方库的js，在html引入</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;add-asset-html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DllReferencePlugin</span>(&#123;</span><br><span class="line">            <span class="attr">manifest</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../dll/manifest.json&#x27;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 把dll下的react.dll.js，拷贝到dist目录下，并让index.html引入react.dll.js</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">AddAssetHtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filepath</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../dll/react.dll.js&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上三步讲解：本地使用了import React 语法，需要先去 manifest.json 中查找，找到后会加载对应的库的名字（ex:react）,可能会引用某个模块，会去dll.js文件中查找</p>
<p>我们在项目中引用react的时候（import React），会先到manifest.json中查找，找到了react，就会从react.dll.js中读取代码，可能react.dll.js中，引用了某个模块（就是manifest.json的配置的模块），会去react.dll.js中读取代码</p>
<h2 id="八：optimization-gt-usedExports-打包文件提示，哪个方法未用到"><a href="#八：optimization-gt-usedExports-打包文件提示，哪个方法未用到" class="headerlink" title="八：optimization -&gt; usedExports : 打包文件提示，哪个方法未用到"></a>八：optimization -&gt; usedExports : 打包文件提示，哪个方法未用到</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 优化项配置</span></span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="comment">// 开发模式下，使用了哪个模块，打包代码中提示一下</span></span><br><span class="line">        <span class="attr">usedExports</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// exports used: minus : 打包结果就会提示minus被使用了</span></span><br><span class="line"><span class="comment">/***/</span> <span class="string">&quot;./src/calc.js&quot;</span>:</span><br><span class="line"><span class="comment">/*!*********************!*\</span></span><br><span class="line"><span class="comment">  !*** ./src/calc.js ***!</span></span><br><span class="line"><span class="comment">  \*********************/</span></span><br><span class="line"><span class="comment">/*! exports provided: add, minus */</span></span><br><span class="line"><span class="comment">/*! exports used: minus */</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="keyword">function</span>(<span class="params"><span class="variable language_">module</span>, __webpack_exports__, __webpack_require__</span>) &#123;&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="九：动态加载文件——实现点击后动态加载文件"><a href="#九：动态加载文件——实现点击后动态加载文件" class="headerlink" title="九：动态加载文件——实现点击后动态加载文件"></a>九：动态加载文件——实现点击后动态加载文件</h2><p>场景：页面上有个按钮，按钮点击方法中调用了 asyncImport.js 中的 addSum 方法，如果 asyncImport.js 文件比较大，而页面上按钮并没有被点击，那么页面初始化的时候加载 asyncImport.js 文件就是浪费的，我们希望当点击按钮的时候，再加载 asyncImport.js 文件，这样比较合理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主入口文件：代码在 index-optimize.js 中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注释掉，改为 click 中动态导入</span></span><br><span class="line"><span class="comment">// import &#123; addSum &#125; from &#x27;./asyncImport.js&#x27;;</span></span><br><span class="line"><span class="keyword">let</span> button = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(addSum(1, 2)); // 注释掉，改为下面的动态导入</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// import语法：动态导入文件  类似路由的懒加载</span></span><br><span class="line">  <span class="comment">// 返回一个promise</span></span><br><span class="line">  <span class="title function_">import</span>(<span class="comment">/*webpackChunkName: &#x27;asyncImportName&#x27;*/</span><span class="string">&#x27;./asyncImport.js&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// /*webpackChunkName: &#x27;asyncImportName&#x27;*/ 是魔法字符串，格式就是这样类似注释</span></span><br><span class="line">    <span class="comment">// 这里设置的名称 asyncImportName 会被传到webpack-&gt; output -&gt; chunkFilename -&gt; [name]</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">addSum</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// webpack 会默认把import()这样的语法单独打包成一个文件，当点击的时候，会用jsonp动态加载这个文件，可以实现代码分割</span></span><br><span class="line">&#125;);</span><br><span class="line">button.<span class="property">innerHTML</span> = <span class="string">&#x27;点我异步加载文件，运行文件中的方法&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(button);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="comment">// 异步打包的名字 ex: import()语法</span></span><br><span class="line">        <span class="attr">chunkFilename</span>: <span class="string">&#x27;[name].min.js&#x27;</span></span><br><span class="line">        <span class="comment">// [name] --- 如果import()语法中写了魔法字符串，其中设置的名字会传入到name中</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="十：多入口文件优化"><a href="#十：多入口文件优化" class="headerlink" title="十：多入口文件优化"></a>十：多入口文件优化</h2><p>需要实现多入口 - 每个文件需要依赖自己的入口文件</p>
<p>ex: index.html 需要 index.js ,  login.html 需要 login.js</p>
<h3 id="webpack-基本配置"><a href="#webpack-基本配置" class="headerlink" title="webpack 基本配置"></a>webpack 基本配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// entry 有3种写法 1：字符串  2：数组   3：对象</span></span><br><span class="line">    <span class="comment">// entry 的多入口配置</span></span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="attr">index</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src/multiple-entry/index.js&#x27;</span>),</span><br><span class="line">        <span class="attr">login</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../src/multiple-entry/login.js&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 配合entry多入口,output也需要多个出口，不然多个模块打包后都是一个名字，会被冲掉</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">        <span class="comment">// 这里的name就是entry的key</span></span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../dist&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// entry 设置多入口了，html 也要配合多个</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../public/index.html&#x27;</span>),</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">chunks</span>: [<span class="string">&#x27;index&#x27;</span>] <span class="comment">// 打包index.html文件，其中引用了index.js</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../public/index.html&#x27;</span>),</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;login.html&#x27;</span>,</span><br><span class="line">            <span class="comment">// chunks: [&#x27;login&#x27;], // 打包login.html文件，其中引用了login.js</span></span><br><span class="line">            <span class="attr">chunks</span>: [<span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;login&#x27;</span>],</span><br><span class="line">            <span class="comment">// 如果 这个 login.html 中需要引用多个js文件，chunks可以设置多个，但是引用顺序并不按chunks中的顺序引用</span></span><br><span class="line">            <span class="comment">// chunksSortMode - 排序模式 : 可以设置 chunks 多个的时候，按照自己排列的顺序引用</span></span><br><span class="line">            <span class="attr">chunksSortMode</span>: <span class="string">&#x27;manual&#x27;</span> <span class="comment">// auto： 按照依赖排序   manual：手动排序,按照chunks的顺序引用js</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 以上配置后，运行 npm run build 会产生2个js文件，2个html文件，并且html引用了相应配置的chunks中的js文件</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>题外话：vue-cli 中配置多入口 mpa 查看cli官网 pages相关</p>
</blockquote>
<h3 id="多如人口文件—生产环境下，第三方公共包（代码）的抽离-：optimization-splitChunks-配置"><a href="#多如人口文件—生产环境下，第三方公共包（代码）的抽离-：optimization-splitChunks-配置" class="headerlink" title="多如人口文件—生产环境下，第三方公共包（代码）的抽离 ：optimization.splitChunks 配置"></a>多如人口文件—生产环境下，第三方公共包（代码）的抽离 ：optimization.splitChunks 配置</h3><p>场景：继续上面多入口文件的情况，如果 multiple-entry 下的 index.js 和 login.js 都引用了 jquery.js，2个js都会单独打包 jquery.js, 不合理</p>
<p>我们希望可以单独抽离jquery的打包—抽离第三方模块，优点如下：</p>
<ul>
<li>第三方模块和业务逻辑分离</li>
<li>增加缓存 304策略 节约加载性能</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件 --- optimization.splitChunks 配置项</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">splitChunks</span>: &#123; <span class="comment">// 多入口文件，第三方公共代码的抽离配置，如果同时配置react的抽离的话，这里的配置没有dll优先级别高</span></span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>, <span class="comment">// async(默认)：支持异步代码的分割 ex：import()</span></span><br><span class="line">            <span class="comment">// async：只异步代码分割   initial：只同步代码分割   all：同步和异步都进行代码分割(单独打包)</span></span><br><span class="line">            <span class="attr">minSize</span>: <span class="number">34</span>, <span class="comment">// 30000：文件超过30k，就会抽离它，，这里配置小点，以方便查看抽离打包效果</span></span><br><span class="line">            <span class="comment">// minRemainingSize: 0, // 最小的尺寸-webpack5新属性，确保拆分后保留的块的最小大小超过限制，从而避免模块大小为零</span></span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">0</span>, <span class="comment">// 最大的Size 0-无限制</span></span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">2</span>, <span class="comment">// 最少模块引用1次才抽离</span></span><br><span class="line">            <span class="attr">maxAsyncRequests</span>: <span class="number">6</span>, <span class="comment">// 最多抽离6个</span></span><br><span class="line">            <span class="attr">maxInitialRequests</span>: <span class="number">4</span>, <span class="comment">// 首页的请求，最多4个</span></span><br><span class="line">            <span class="attr">automaticNameDelimiter</span>: <span class="string">&#x27;~&#x27;</span>, <span class="comment">// 抽离的名字中间的分隔符 ex：xxx~a~b</span></span><br><span class="line">            <span class="attr">automaticNameMaxLength</span>: <span class="number">30</span>, <span class="comment">// 最长的名字的大小不能超过30字符</span></span><br><span class="line">            <span class="attr">cacheGroups</span>: &#123; <span class="comment">// 缓存组</span></span><br><span class="line">                <span class="comment">// 这里的优先级高级 splitChunks 下的设置</span></span><br><span class="line">                <span class="attr">vue</span>: &#123; <span class="comment">// vur~index~login.min.js</span></span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vue/</span>, <span class="comment">// node_modules 下的 vue</span></span><br><span class="line">                    <span class="attr">priority</span>: -<span class="number">1</span> <span class="comment">// 优先级  优先级别高的话，打包的时候会先匹配</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">defaultVendors</span>: &#123; <span class="comment">// defaultVendors~index~login.min.js</span></span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    <span class="attr">priority</span>: -<span class="number">10</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">common</span>: &#123; <span class="comment">// common~index~login.min.js</span></span><br><span class="line">                    <span class="attr">minChunks</span>: <span class="number">2</span>, <span class="comment">// 至少引用2次</span></span><br><span class="line">                    <span class="attr">priority</span>: -<span class="number">20</span>,</span><br><span class="line">                    <span class="attr">reuseExistingChunk</span>: <span class="literal">true</span> <span class="comment">// 此项配置是否启用</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// login.js | index.js 2个文件中代码几乎相同，主要为了作用是代码中引用的模块都引用了2次</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步导入lodash</span></span><br><span class="line"><span class="keyword">import</span> lodash <span class="keyword">from</span> <span class="string">&#x27;lodash&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(lodash);</span><br><span class="line"><span class="comment">// 同步导入mergeDeepObject</span></span><br><span class="line"><span class="keyword">import</span> mergeDeepObject <span class="keyword">from</span> <span class="string">&#x27;mergeDeepObject&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">mergeDeepObject</span>(&#123;<span class="attr">a</span>:<span class="number">1</span>, <span class="attr">b</span>:<span class="number">2</span>&#125;));</span><br><span class="line"><span class="comment">// (1)：以上同步引入的 lodash 和 mergeDeepObject 都是 node_modules 下的包，所以被一起打包到 defaultVendors~index~login.min.js 中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步导入vue</span></span><br><span class="line"><span class="comment">// 注意这里配置的 priority 需要高于 defaultVendors 的 priority， 代码才会被单独抽离，否则会被一同打包到 defaultVendors~index~login.min.js 中</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Vue</span>);</span><br><span class="line"><span class="comment">// (2)：这里匹配到了 webpack -&gt; optimization -&gt; splitChunks -&gt; cacheGroups -&gt; vue  所以抽离打包到 vur~index~login.min.js 中</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;I am index.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态导入 asyncImport   import()语法默认自动进行代码分割，不管webpack -&gt; optimization -&gt; splitChunks -&gt; chunks 是 async 还是 initial</span></span><br><span class="line"><span class="title function_">import</span>(<span class="comment">/*webpackChunkName: &#x27;asyncImportName&#x27;*/</span><span class="string">&#x27;../asyncImport.js&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 这里设置的名称 asyncImportName 会被传到 webpack-&gt; output -&gt; chunkFilename -&gt; [name]，没写魔法字符串的话，name默认从0开始递增</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">addSum</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// (3)：以上动态导入 asyncImport 代码，代码抽离一个单独的模块，应用魔法字符串的名字，asyncImportName.min.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步引入 multipleImportFile 模块</span></span><br><span class="line"><span class="keyword">import</span> multipleImportFile <span class="keyword">from</span> <span class="string">&#x27;./multiple-import-file&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">multipleImportFile</span>(<span class="number">2</span>, <span class="number">4</span>));</span><br><span class="line"><span class="comment">// (4)：以上匹配到 webpack -&gt; optimization -&gt; splitChunks -&gt; cacheGroups -&gt; common  所以抽离打包到 common~index~login.min.js 中</span></span><br></pre></td></tr></table></figure>

<p>以上配置一共会对应生成4个文件：</p>
<ul>
<li>asyncImportName.min.js</li>
<li>common<del>index</del>login.min.js </li>
<li>defaultVendors<del>index</del>login.min.js</li>
<li>vue<del>index</del>login.min.js</li>
</ul>
<blockquote>
<p>扩展： dll 和 optimization.splitChunks 都可以实现第三方抽离<br>dll 是先生成文件，开发时打包的时候不再打包dll配置的文件，加快开发时的打包速度<br>optimization.splitChunks 代码分割是在生产的时候，把第三方公共的库单独打包，使公共模块和业务模块代码分离，防止公共模块代码的重复加载等</p>
</blockquote>
<h2 id="打包文件分析工具-webpack-bundle-analyzer-插件（界面化工具）"><a href="#打包文件分析工具-webpack-bundle-analyzer-插件（界面化工具）" class="headerlink" title="打包文件分析工具 - webpack-bundle-analyzer 插件（界面化工具）"></a>打包文件分析工具 - webpack-bundle-analyzer 插件（界面化工具）</h2><p>可以分析打包的依赖关系和文件的大小，按下面代码块配置好之后，运行 npm run build 就会默认启用一个8888端口的服务，页面上会展示出此次打包出的模块的信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install --save-dev webpack-bundle-analyzer</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 打包分析插件</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">BundleAnalyzerPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-bundle-analyzer&#x27;</span>);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        !isDev &amp;&amp; <span class="keyword">new</span> <span class="title class_">BundleAnalyzerPlugin</span>()</span><br><span class="line">        <span class="comment">// 生产环境下应用，运行npm run build 会起一个 http://127.0.0.1:8888 服务，里面可以看到具体的打包情况，界面化工具</span></span><br><span class="line">    ].<span class="title function_">filter</span>(<span class="title class_">Boolean</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="费时分析工具"><a href="#费时分析工具" class="headerlink" title="费时分析工具"></a>费时分析工具</h2><p>可以分析每个模块打包用了多长时间</p>
<blockquote>
<p>这里就写这么多吧，官方文档这么写的，但是我加了这个插件以后，打包就报错，并且搜索这个问题很长时间都没能解决，暂时放弃了<br>Plugin could not be registered at ‘html-webpack-plugin-before-html-processing’. Hook was not found.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install speed-measure-webpack-plugin</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 费时分析插件 - 速度测量插件</span></span><br><span class="line"><span class="keyword">const</span> speedMeasureWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;speed-measure-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="comment">// 这个插件要先 new 一下，然后在包裹（wrap）一下webpack的配置对象</span></span><br><span class="line"><span class="keyword">const</span> smw = <span class="keyword">new</span> <span class="title function_">speedMeasureWebpackPlugin</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> smw.<span class="title function_">wrap</span>(baseWebpackConfig));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2019-12-20-webpack%E4%BC%98%E5%8C%96/" data-id="cl1fzqfxu0010vgnuh1kw0sey" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2019-11-19-HTTP基础" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2019-11-19-HTTP%E5%9F%BA%E7%A1%80/" class="article-date">
  <time datetime="2022-03-29T02:49:29.881Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%A8%E8%BE%B9/">周边</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2019-11-19-HTTP%E5%9F%BA%E7%A1%80/">HTTP基础扫盲</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h2><h3 id="1XX"><a href="#1XX" class="headerlink" title="1XX"></a>1XX</h3><ul>
<li>101 webscoket 双向通信</li>
</ul>
<h3 id="2XX-成功"><a href="#2XX-成功" class="headerlink" title="2XX - 成功"></a>2XX - 成功</h3><ul>
<li>200 成功</li>
<li>204 没有响应体</li>
<li>206 断点续传</li>
</ul>
<h3 id="3XX-重定向"><a href="#3XX-重定向" class="headerlink" title="3XX - 重定向"></a>3XX - 重定向</h3><ul>
<li>301 永久重定向（一心一意）</li>
<li>302 临时重定向（三心二意）</li>
<li>304 缓存（只能服务端设置）</li>
</ul>
<h3 id="4XX-客户端出错"><a href="#4XX-客户端出错" class="headerlink" title="4XX - 客户端出错"></a>4XX - 客户端出错</h3><ul>
<li>401 没有权限（未登录）</li>
<li>403 没有权限（已登录）</li>
<li>404 </li>
<li>405 请求方法不存在、不支持（ex：服务器只支持get，post，我发了delete）</li>
</ul>
<h3 id="5XX-服务端错误"><a href="#5XX-服务端错误" class="headerlink" title="5XX - 服务端错误"></a>5XX - 服务端错误</h3><ul>
<li>502 负载均衡</li>
<li>500 服务器挂了</li>
</ul>
<h2 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h2><blockquote>
<p>补充概念：<br>RestfulApi：关于用户的接口定义为&#x2F;user， 根据请求方法不同，进行不同的操作，方法如下</p>
</blockquote>
<h3 id="get-获取资源"><a href="#get-获取资源" class="headerlink" title="get - 获取资源"></a>get - 获取资源</h3><h3 id="post-新增资源"><a href="#post-新增资源" class="headerlink" title="post - 新增资源"></a>post - 新增资源</h3><h3 id="put-上传文件-x2F-修改"><a href="#put-上传文件-x2F-修改" class="headerlink" title="put - 上传文件&#x2F;修改"></a>put - 上传文件&#x2F;修改</h3><h3 id="delete-删除资源"><a href="#delete-删除资源" class="headerlink" title="delete - 删除资源"></a>delete - 删除资源</h3><h3 id="options-跨域的方法，复杂请求时出现"><a href="#options-跨域的方法，复杂请求时出现" class="headerlink" title="options - 跨域的方法，复杂请求时出现"></a>options - 跨域的方法，复杂请求时出现</h3><p>复杂请求：</p>
<ol>
<li>put | delete&#x3D;复杂请求</li>
<li>post请求，并且增加了自定义的header</li>
</ol>
<h2 id="数据传输"><a href="#数据传输" class="headerlink" title="数据传输"></a>数据传输</h2><ul>
<li><p>请求行 url</p>
</li>
<li><p>请求头 自定义header</p>
</li>
<li><p>请求体 提交的数据</p>
</li>
<li><p>相应行 状态码</p>
</li>
<li><p>响应头 可以自定义</p>
</li>
<li><p>响应体 返回给浏览器的结果</p>
</li>
</ul>
<p>node的http模块应用，点击<a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/tree/master/5.http">这里</a></p>
<h2 id="http优化策略"><a href="#http优化策略" class="headerlink" title="http优化策略"></a>http优化策略</h2><ul>
<li>压缩<ul>
<li>res.setHeader(‘Content-Encoding’, ‘gzip’);</li>
<li>res.setHeader(‘Content-Encoding’, ‘deflate’);</li>
<li>req.headers[‘accept-encoding’];</li>
</ul>
</li>
<li>缓存<ul>
<li>res.setHeader(‘Cache-Control’, ‘max-age&#x3D;5’);</li>
<li>Last-Modified</li>
<li>Etag</li>
</ul>
</li>
</ul>
<p>具体代码点击<a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/blob/master/6.myHttpServer/src/server.js">这里</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2019-11-19-HTTP%E5%9F%BA%E7%A1%80/" data-id="cl1fzqfvy000kvgnuhxxmbblf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2019-12-16-webpack基础配置" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2019-12-16-webpack%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2022-03-29T02:49:29.881Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%91%A8%E8%BE%B9/">周边</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2019-12-16-webpack%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">webpack 4.0+ 笔记(基础配置)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址"></a>代码地址</h2><p><a target="_blank" rel="noopener" href="https://github.com/happychong/2019-zhufeng/tree/master/9.webpack">https://github.com/happychong/2019-zhufeng/tree/master/9.webpack</a></p>
<h2 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli</span><br></pre></td></tr></table></figure>

<h2 id="webpack-的作用（目的）"><a href="#webpack-的作用（目的）" class="headerlink" title="webpack 的作用（目的）"></a>webpack 的作用（目的）</h2><ol>
<li>文件体积变小</li>
<li>打包速度提升</li>
<li>模块拆分</li>
</ol>
<h2 id="基础-webpack-配置文件（webpack-config-js）"><a href="#基础-webpack-配置文件（webpack-config-js）" class="headerlink" title="基础 webpack 配置文件（webpack.config.js）"></a>基础 webpack 配置文件（webpack.config.js）</h2><p>webpack 基于node， 语法遵守commonjs规范，配置文件（默认webpack.config.js）有2种导出格式，如下</p>
<h3 id="1：导出配置对象"><a href="#1：导出配置对象" class="headerlink" title="1：导出配置对象"></a>1：导出配置对象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="comment">// 模式： development-开发模式</span></span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="comment">// entry: 入口,路径采用绝对路径</span></span><br><span class="line">    <span class="attr">entry</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src/index.js&#x27;</span>),</span><br><span class="line">    <span class="comment">// output: 出口, </span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">        <span class="comment">// 出口位置</span></span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-导出函数"><a href="#2-导出函数" class="headerlink" title="2.导出函数"></a>2.导出函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// env 是环境变量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回配置文件，没返回的话，采用默认配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="webpack-scripts命令行参数"><a href="#webpack-scripts命令行参数" class="headerlink" title="webpack scripts命令行参数"></a>webpack scripts命令行参数</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;mode&quot;</span>: <span class="string">&quot;webpack --mode development&quot;</span>,</span><br><span class="line">        <span class="string">&quot;env&quot;</span>: <span class="string">&quot;webpack --env.development&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>–mode ：模式<ul>
<li>development : 开发环境</li>
<li>production : 生产环境</li>
</ul>
</li>
<li>–env ：环境变量<ul>
<li>–env&#x3D;aa : env就是aa</li>
<li>–env.aa : env是个对象，会在对象上加个aa属性</li>
</ul>
</li>
<li>–config ：指定执行的文件是哪个 （默认执行webpack.config.js 或 webpack.file.js)</li>
</ul>
<h2 id="项目中，webpack-配置规范"><a href="#项目中，webpack-配置规范" class="headerlink" title="项目中，webpack 配置规范"></a>项目中，webpack 配置规范</h2><p>一般情况下，一个项目至少分两个模式，一个开发模式，一个生产模式，两个模式中共同的部分，设置为基本配置，目录如下（build目录）</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">myproject</span><br><span class="line">    │─package.json</span><br><span class="line">    │─src</span><br><span class="line">    │   └─index.js</span><br><span class="line">    └─build</span><br><span class="line">        │─webpack.base.js</span><br><span class="line">        │─webpack.dev.js</span><br><span class="line">        └─webpack.prod.js</span><br></pre></td></tr></table></figure>

<h2 id="webpack-dev-server-开发环境静态服务"><a href="#webpack-dev-server-开发环境静态服务" class="headerlink" title="webpack-dev-server 开发环境静态服务"></a>webpack-dev-server 开发环境静态服务</h2><p>webpack-dev-server 在内存中打包，不会产生实体文件</p>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p>直接把 webpack 改为 webpack-dev-server</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;dev&quot;</span>: <span class="string">&quot;webpack-dev-server --env.development&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="headerlink" title="html-webpack-plugin"></a>html-webpack-plugin</h2><p>打包的html中自动引入js，且可配置压缩等功能</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i html-plugin --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="comment">// 1：导入</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="comment">// 2：new</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../public/index.html&#x27;</span>),</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>,</span><br><span class="line">            <span class="comment">// 压缩 一般开发模式不压缩，生产模式压缩</span></span><br><span class="line">            <span class="attr">minify</span>: &#123;</span><br><span class="line">                <span class="comment">// 双引号 去掉</span></span><br><span class="line">                <span class="attr">removeAttributeQuotes</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// html整体压缩为一行</span></span><br><span class="line">                <span class="attr">collapseWhitespace</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="clean-webpack-plugin-清空打包路径"><a href="#clean-webpack-plugin-清空打包路径" class="headerlink" title="clean-webpack-plugin  清空打包路径"></a>clean-webpack-plugin  清空打包路径</h2><h3 id="安装-clean-webpack-plugin"><a href="#安装-clean-webpack-plugin" class="headerlink" title="安装 clean-webpack-plugin"></a>安装 clean-webpack-plugin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i npm i clean-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<h3 id="使用-clean-webpack-plugin"><a href="#使用-clean-webpack-plugin" class="headerlink" title="使用 clean-webpack-plugin"></a>使用 clean-webpack-plugin</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="comment">// 1：导入</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="comment">// 2：new</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="comment">// 在打包目录清空 默认就是全部清空，所以可以不设置此参数</span></span><br><span class="line">            <span class="attr">cleanOnceBeforeBuildPatterns</span>: [<span class="string">&#x27;**/*&#x27;</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="loaders"><a href="#loaders" class="headerlink" title="loaders"></a>loaders</h2><p>loader的执行顺序，默认是从下往上执行  从右往左执行</p>
<p>详细设置可以查看这里</p>
<h3 id="1-css"><a href="#1-css" class="headerlink" title="1.css"></a>1.css</h3><p>需要 css-loader &amp; style-loader</p>
<ul>
<li>css-loader: 解析css语法，并把解析后的语法传递给style-loader</li>
<li>style-loader: 将css变成style标签插入到页面中</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install css-loader style-loader --save-dev</span><br></pre></td></tr></table></figure>

<h4 id="预处理器"><a href="#预处理器" class="headerlink" title="预处理器"></a>预处理器</h4><ul>
<li>(.scss)    — node-sass    sass-loader</li>
<li>(.less)    — less         less-loader</li>
<li>(.stylus)  — stylus       stylus-loader</li>
</ul>
<h4 id="postcss-loader-给css属性加前缀（-webkit"><a href="#postcss-loader-给css属性加前缀（-webkit" class="headerlink" title="postcss-loader  给css属性加前缀（__webkit)"></a>postcss-loader  给css属性加前缀（__webkit)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm i postcss-loader autoprefixer --save-dev</span><br><span class="line"><span class="comment"># postcss-loader 需要 autoprefixer 插件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// postcss.config.js - postcss-loader 需要配置文件</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">&#x27;autoprefixer&#x27;</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .browserslistrc - 设置添加前缀已什么浏览器为标准</span></span><br><span class="line"><span class="comment">// autoprefixer需要的配置，很多其他的包可以公用这个配置文件</span></span><br><span class="line"><span class="comment">// https://github.com/browserslist/browserslist#best-practices</span></span><br><span class="line">cover <span class="number">99.5</span>% </span><br></pre></td></tr></table></figure>

<h4 id="mini-css-extract-plugin-又是插件，又是loader"><a href="#mini-css-extract-plugin-又是插件，又是loader" class="headerlink" title="mini-css-extract-plugin 又是插件，又是loader"></a>mini-css-extract-plugin 又是插件，又是loader</h4><p>单独抽离css文件，线上并行链接css</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm i mini-css-extract-plugin --save-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader 设置</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.css/</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                <span class="comment">// 开发模式不抽离单独css，生产模式抽离</span></span><br><span class="line">                isDev ? <span class="string">&#x27;style-loader&#x27;</span> : <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">                <span class="comment">// ……后续省略</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugins 设置</span></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 生产模式下，设置抽离样式文件名称</span></span><br><span class="line">    <span class="comment">// 但是抽离出的样式文件未压缩，在webpack.prod.js &gt; optimization &gt; minimizer &gt; OptimizeCSSAssetsPlugin 配置压缩css文件</span></span><br><span class="line">    !isDev &amp;&amp; <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;css/base.css&#x27;</span></span><br><span class="line">    &#125;).<span class="title function_">filter</span>(<span class="title class_">Boolean</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>但是抽离的样式文件不会压缩，如果需要压缩，需要单独配置优化项配置：optimization</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">OptimizeCSSAssetsPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserWbpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">minimizer</span>: [ <span class="comment">// 压缩方案</span></span><br><span class="line">            <span class="comment">// 压缩css文件，用了这个以后，js也得手动压缩了</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">OptimizeCSSAssetsPlugin</span>(),</span><br><span class="line">            <span class="comment">// 压缩js文件</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TerserWbpackPlugin</span>()</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-图片-icon"><a href="#2-图片-icon" class="headerlink" title="2.图片 + icon"></a>2.图片 + icon</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|png|gif)$/</span>,</span><br><span class="line">            <span class="comment">// use: &#x27;file-loader&#x27; // file-loader 默认功能是拷贝</span></span><br><span class="line">            <span class="attr">use</span>: &#123;</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>, </span><br><span class="line">                <span class="comment">// 希望当前比较小的图片转化为 base64 ，转化后尺寸比以前大，但是不用发http请求了</span></span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="comment">// 大于 100k 的图片，会用 file-loader</span></span><br><span class="line">                    <span class="attr">limit</span>: <span class="number">8</span> * <span class="number">1024</span>, <span class="comment">// 一般为 8*1024</span></span><br><span class="line">                    <span class="comment">// 打包到目录下</span></span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;image/[contentHash].[ext]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 图标字体，一般不转base64，有时会失效</span></span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(woff|ttf|eot|svg)$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-js"><a href="#3-js" class="headerlink" title="3.js"></a>3.js</h3><h4 id="es6-gt-es5"><a href="#es6-gt-es5" class="headerlink" title="es6 -&gt; es5"></a>es6 -&gt; es5</h4><p>babel提供转化功能， vue-cli 基于babel6实现的，当前babel7</p>
<p>babel需要的包：</p>
<ul>
<li>@babel&#x2F;core ： babel核心模块</li>
<li>@babel&#x2F;preset-env ： 预设</li>
<li>babel-loader ： babel 与 webpack 的桥梁</li>
</ul>
<blockquote>
<p>babel-loader 默认调用 @babel&#x2F;core 转化代码， @babel&#x2F;core 调用 @babel&#x2F;preset-env 方式来解析 es6 转化为 es5</p>
</blockquote>
<blockquote>
<p>@babel: 作用域 把所有关于babel的模块都放在babel下，防止重名，有利于分包</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install @babel/core  @babel/preset-env  babel-loader --save-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader 设置</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">        <span class="comment">// presets 执行顺序从下往上执行</span></span><br><span class="line">        [<span class="string">&quot;@babel/preset-env&quot;</span>, &#123;</span><br><span class="line">            <span class="comment">// 构建时候，如果用到了实例上的某API，按需加载转化</span></span><br><span class="line">            <span class="string">&quot;useBuiltIns&quot;</span>: <span class="string">&quot;usage&quot;</span>,</span><br><span class="line">            <span class="comment">// useBuiltIns 转化的时候，不知道includes是字符串的，还是数组的，需要corejs，就是bable-core</span></span><br><span class="line">            <span class="comment">// corejs == 以前的 babel-polyfill</span></span><br><span class="line">            <span class="string">&quot;corejs&quot;</span>: <span class="number">3</span></span><br><span class="line">        &#125;]</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">        <span class="comment">// 执行顺序：从上到下执行</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ** 解析装饰器 **</span></span><br><span class="line">        <span class="comment">// @babel/plugin-proposal-decorators 要用在 @babel/plugin-proposal-class-properties 之前</span></span><br><span class="line">        <span class="comment">// legacy: true --- 保留装饰器，，legacy 为 true 的条件，下面的 loose 也得是 true</span></span><br><span class="line">        [<span class="string">&quot;@babel/plugin-proposal-decorators&quot;</span>, &#123;<span class="string">&quot;legacy&quot;</span>: <span class="literal">true</span>&#125;],</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ** 解析类 **</span></span><br><span class="line">        <span class="comment">// 类的插件 之类一个数组是一项，写成数组是为了传参</span></span><br><span class="line">        <span class="comment">// loose:宽松,loose为true的话，可以用装饰器，为false的话，会打包转化成definePropty</span></span><br><span class="line">        [<span class="string">&quot;@babel/plugin-proposal-class-properties&quot;</span>, &#123;<span class="string">&quot;loose&quot;</span>: <span class="literal">true</span>&#125;],</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ** 减少打包代码冗余 **</span></span><br><span class="line">        <span class="comment">// 多个模块转化时候，会产生打包的冗余代码</span></span><br><span class="line">        <span class="comment">// 比如多个文件都class A的方式创建类，那么打包后多个包中都有_classCallCheck方法</span></span><br><span class="line">        <span class="string">&quot;@babel/plugin-transform-runtime&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="react"><a href="#react" class="headerlink" title="react"></a>react</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 @babel/preset-react   preset类就是个插件的集合</span></span><br><span class="line">npm install @babel/preset-react --save-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">        <span class="comment">// 这里省略关于 js 的设置</span></span><br><span class="line">        <span class="string">&quot;@babel/preset-react&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install vue-loader vue-template-compiler --save-dev</span><br><span class="line"><span class="comment"># webpack 用 vue-loader 来调用 vue-template-compiler解析语法</span></span><br><span class="line"><span class="comment"># vue-template-compiler: 解析当前项目 App.vue 中的&lt;template&gt;的包</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 配置文件设置</span></span><br><span class="line"><span class="comment">// vue-loader 要求，还需要使用插件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">VueLoaderPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;vue-loader/lib/plugin&#x27;</span>);</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="comment">// loader 设置</span></span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.vue?$/</span>,</span><br><span class="line">                <span class="attr">use</span>: <span class="string">&#x27;vue-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// plugins 设置</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">VueLoaderPlugin</span>()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="vue-property-decorator-vue-属性的装饰器"><a href="#vue-property-decorator-vue-属性的装饰器" class="headerlink" title="vue-property-decorator - vue 属性的装饰器"></a>vue-property-decorator - vue 属性的装饰器</h5><p>在App.vue中，还会有script标签，还要用ts语法,所以用到 vue-property-decorator 包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install vue-property-decorator --save</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.vue - script 标签中的应用</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    hello Vue</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(todo, index) in todos&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123; todo &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">Component</span>, <span class="title class_">Vue</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-property-decorator&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">@<span class="title class_">Component</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// todo...</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Todo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Vue</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    public <span class="attr">todos</span>:string[] = [<span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>但是 @babel&#x2F;preset-typescript 打包的时候，还是会认为上面代码中script部分是vue的模块内容，没认为是ts语法，所以.babelrc中，@babel&#x2F;preset-typescript 设置还需要加 “allExtensions”: true</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">        [<span class="string">&quot;@babel/preset-typescript&quot;</span>, &#123;</span><br><span class="line">            <span class="comment">// 表示检测所有扩展名</span></span><br><span class="line">            <span class="string">&quot;allExtensions&quot;</span>: <span class="literal">true</span></span><br><span class="line">        &#125;]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>vue中没有jsx，所以使用ts的文件后缀为ts</p>
</blockquote>
<h5 id="XXX-d-ts"><a href="#XXX-d-ts" class="headerlink" title="XXX.d.ts"></a>XXX.d.ts</h5><p>index-vue.ts 中引入 App.vue(import App from ‘.&#x2F;App.vue’;) 会报错，需要在XXX.d.ts（本项目中名称为vue-shims.d.ts）配置解决报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue-shims.d.ts</span></span><br><span class="line"><span class="comment">// 说明：ts文件中，import vue类型文件的时候，认为是个vue类型的模块</span></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&quot;*.vue&quot;</span> &#123;</span><br><span class="line">    <span class="comment">// ts里，类可以当做类型</span></span><br><span class="line">    <span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Vue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="TS-TypeScript"><a href="#TS-TypeScript" class="headerlink" title="TS - TypeScript"></a>TS - TypeScript</h4><p>使用TS有2种方案</p>
<h5 id="ts-loader"><a href="#ts-loader" class="headerlink" title="ts-loader"></a>ts-loader</h5><p>专门处理ts文件的，需要配合 typescript 库</p>
<h5 id="babel7版本-babel-x2F-preset-typescript"><a href="#babel7版本-babel-x2F-preset-typescript" class="headerlink" title="babel7版本 @babel&#x2F;preset-typescript"></a>babel7版本 @babel&#x2F;preset-typescript</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm i @babel/preset-typescript --save-dev</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// loader 设置</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.tsx?$/</span>,</span><br><span class="line">            <span class="attr">use</span>: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">        <span class="comment">// 这里省略关于 js 的设置</span></span><br><span class="line">        <span class="comment">// 这里省略关于 react 的设置</span></span><br><span class="line">        <span class="string">&quot;@babel/preset-typescript&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="typescript-相关"><a href="#typescript-相关" class="headerlink" title="typescript 相关"></a>typescript 相关</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># typescript 包 - 校验tc代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm i typescript</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行（npx）并初始化（--init）typescript 配置文件 tsconfig.json</span></span><br><span class="line">npx typescript --init</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 typescript 的 react 和 react-dom 的提示 的包</span></span><br><span class="line">npm install @types/react @types/react-dom --save</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tsconfig.json 中 jsx 的配置</span></span><br><span class="line"><span class="comment">// 使代码中 jsx 的部分不报错</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;compilerOptions&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;jsx&quot;</span>: <span class="string">&quot;react&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2019-12-16-webpack%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" data-id="cl1fzqfvz000lvgnufs4k16b5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="default-2019-11-01-JS中，0.1+0.2＞0.3为什么？" class="article article-type-default" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2022/03/29/2019-11-01-JS%E4%B8%AD%EF%BC%8C0.1+0.2%EF%BC%9E0.3%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F/" class="article-date">
  <time datetime="2022-03-29T02:49:29.879Z" itemprop="datePublished">2022-03-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2022/03/29/2019-11-01-JS%E4%B8%AD%EF%BC%8C0.1+0.2%EF%BC%9E0.3%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F/">0.1+0.2 &gt; 0.3 Why???</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="一：抛砖"><a href="#一：抛砖" class="headerlink" title="一：抛砖"></a>一：抛砖</h2><p>众所周知，js中，浮点数的运算是不靠谱的（因为JS仅有Number这个数值类型，而Number采用的时IEEE 754 64位双精度浮点数编码），正如标题所示，0.1 + 0.2 并不等于 0.3</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 浏览器的console中查看</span></span><br><span class="line"><span class="number">0.1</span>+<span class="number">0.2</span></span><br><span class="line"><span class="comment">// 0.30000000000000004</span></span><br></pre></td></tr></table></figure>

<h2 id="二：引玉"><a href="#二：引玉" class="headerlink" title="二：引玉"></a>二：引玉</h2><p>如果想搞清楚 0.1 + 0.2 等于几，首先需要先看看 0.1 转换成二进制数是什么样的，接下来就先看看进制转化的方法吧</p>
<h3 id="1-小数转换成2进制的方法"><a href="#1-小数转换成2进制的方法" class="headerlink" title="1 小数转换成2进制的方法"></a>1 小数转换成2进制的方法</h3><p>乘 2 取整法 ，具体转化过程如下，0.1 的转换过程</p>
<h3 id="2-0-1-转化为2进制"><a href="#2-0-1-转化为2进制" class="headerlink" title="2 - 0.1 转化为2进制"></a>2 - 0.1 转化为2进制</h3><p>结果：0.0001100110011001100110011001100110011001100110011001101</p>
<p>过程：</p>
<ul>
<li>0.1 * 2 &#x3D; 0.2    &#x3D;&gt; 0</li>
<li>0.2 * 2 &#x3D; 0.4    &#x3D;&gt; 0</li>
<li>0.4 * 2 &#x3D; 0.8    &#x3D;&gt; 0</li>
<li>0.8 * 2 &#x3D; 1.6    &#x3D;&gt; 1 ———</li>
<li>0.6 * 2 &#x3D; 1.2    &#x3D;&gt; 1    |</li>
<li>0.2 * 2 &#x3D; 0.4    &#x3D;&gt; 0    |  这个1100的结果会一直重复下去，直到最后一位，会被进1</li>
<li>0.4 * 2 &#x3D; 0.8    &#x3D;&gt; 0 ———</li>
<li>0.8 * 2 &#x3D; 1.6    &#x3D;&gt; 1</li>
<li>0.6 * 2 &#x3D; 1.2    &#x3D;&gt; 1</li>
</ul>
<p>因为最后一位进1，所以 0.1 转换为2进制后，实际比以前大了一点点</p>
<h3 id="2-0-2-转化为2进制"><a href="#2-0-2-转化为2进制" class="headerlink" title="2 - 0.2 转化为2进制"></a>2 - 0.2 转化为2进制</h3><p>结果：0.001100110011001100110011001100110011001100110011001101</p>
<p>可以发现，也是个1100无线循环的过程，最后一位进1，所以同样 0.2 转换为2进制后，也比以前大了一点点</p>
<h3 id="3-结论"><a href="#3-结论" class="headerlink" title="3 - 结论"></a>3 - 结论</h3><p>那么比 0.1 大了一点点的数 + 比 0.2 大了一点点的数，当然这2个数相加就大于 0.3 了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://happychong.github.io/2022/03/29/2019-11-01-JS%E4%B8%AD%EF%BC%8C0.1+0.2%EF%BC%9E0.3%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F/" data-id="cl1fzqfvv000hvgnu04ybexos" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&amp;laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">下一页 &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/04/08/2022-04-08-vuex%E5%8E%9F%E7%90%86/">Vuex 原理</a>
          </li>
        
          <li>
            <a href="/2022/03/31/2022-03-31-github%20password%20authentication%20was%20removed%20on%20August%2013,%202021.%20Please%20use%20a%20personal%20access%20token%20instead/">2022-03-31-password authentication was removed on August 13, 2021. Please use a personal access token instead.</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2021-08-05-%E9%9D%A2%E8%AF%95%E9%A2%98%E6%80%BB%E7%BB%93%EF%BC%88%E9%9D%9EVue%EF%BC%89/">2021-08-05-面试题总结（非Vue）</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2021-08-05-typescript/">typescript</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2018-1-11-HEXO-hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2021-03-22-git%20bash%20arrow%20%E4%B8%8D%E8%83%BD%E9%80%89%E6%8B%A9%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88(windows)/">git bash arrow 不能选择解决方案(windows)</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-3-20-webpack%E5%8E%9F%E7%90%86/">webpack 原理与实现</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-3-25-webpack-loader%E5%8E%9F%E7%90%86/">webpack - loader 原理与实现</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-07-22-Vue%E9%9D%A2%E8%AF%95%E9%A2%98/">Vue 面试题</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-05-11-mangoDB/">mongoDB</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-07-22-Vue%E5%9F%BA%E7%A1%80/">Vue 基础知识</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-04-23-ast/">ast（语法树）</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-04-27-dart/">Dart 入门</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-04-14-node%E8%BF%9B%E7%A8%8B%EF%BC%88process%EF%BC%89/">Node 的 进程 (process)</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-04-21-node%E8%BF%9B%E7%A8%8B%EF%BC%88pm2%EF%BC%89/">Node 的 进程(pm2)</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2020-03-30-webpack%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/">webpack - 源码编译流程</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-12-20-webpack%E4%BC%98%E5%8C%96/">webpack 4.0 + 笔记(优化)</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-11-19-HTTP%E5%9F%BA%E7%A1%80/">HTTP基础扫盲</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-12-16-webpack%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">webpack 4.0+ 笔记(基础配置)</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-11-01-JS%E4%B8%AD%EF%BC%8C0.1+0.2%EF%BC%9E0.3%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F/">0.1+0.2 &gt; 0.3 Why???</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-11-01-Node%E4%B8%AD%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%BB%E5%86%99%E6%A8%A1%E5%9D%97---FS/">Node -文件读写模块--- fs</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-11-07-node%E6%B7%B1%E5%BA%A6%E5%88%A0%E9%99%A4%E7%9B%AE%E5%BD%95%E5%8F%8A%E7%9B%AE%E5%BD%95%E9%87%8C%E7%9A%84%E5%86%85%E5%AE%B9-fs%E5%88%A0%E9%99%A4%E6%89%A9%E5%B1%95/">Node - 深度（完全）删除目录及目录里的内容 - 扩展</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-24-npm%E5%91%BD%E4%BB%A4%E4%B8%8E%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90/">npm 命令与配置解析</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-30-Node---buffer/">Node --- buffer</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-14-node%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86/">Node模块加载原理</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-14-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%9C%8D%E5%8A%A1/">单线程与多线程的基本概念</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-16-Node%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%EF%BC%88event%20loop%EF%BC%89/">Node中的事件轮询（event loop）</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-14-node%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97-%E7%AE%80%E8%BF%B0/">Node核心模块 - 简述</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-12-node%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E6%89%AB%E7%9B%B2/">Node基本概念扫盲</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-12-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%ADjs%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%EF%BC%88event%20loop%EF%BC%89/">浏览器中javascript的事件循环（event loop）</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-09-05-es6+---%E7%B1%BB%E7%9A%84%E4%BF%AE%E9%A5%B0/">es6+---类的修饰</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-10-05-vue%20nextTick%E5%8E%9F%E7%90%86/">vue nextTick原理</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2018-08-08-vue%20%E5%BC%BA%E5%88%B6%E6%9B%B4%E6%96%B0%E8%AF%95%E5%9B%BE%E7%9A%84%E6%96%B9%E6%B3%95/">vue 强制更新试图 的方法</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2019-09-03-es+---class%E7%94%A8%E6%B3%95%E7%AC%94%E8%AE%B0%20/">es6、7-类的定义</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2016-05-19-%E5%AE%8B%E6%99%93%E4%B8%B9%E7%9A%84%E4%B8%AA%E4%BA%BA%E7%AE%80%E5%8E%86/">宋晓丹的个人简历</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2016-05-11-windows%E4%B8%8B%EF%BC%8CATOM%E5%B8%B8%E7%94%A8%E7%BC%96%E8%BE%91%E5%99%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/">ATOM常用快捷键</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2016-05-05-Git%E5%91%BD%E4%BB%A4/">Git常用命令</a>
          </li>
        
          <li>
            <a href="/2022/03/29/2016-05-05-%E5%9F%BA%E6%9C%ACshell%E5%91%BD%E4%BB%A4/">基本SHELL命令使用</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Dart/">Dart</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node/">Node</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/es6/">es6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongoDB/">mongoDB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA/">个人</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%91%A8%E8%BE%B9/">周边</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dart/" rel="tag">Dart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EventLoop/" rel="tag">EventLoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/" rel="tag">Node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ast/" rel="tag">ast</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/buffer/" rel="tag">buffer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/class/" rel="tag">class</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/core/" rel="tag">core</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event-loop/" rel="tag">event loop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/events/" rel="tag">events</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fs/" rel="tag">fs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/happyChong/" rel="tag">happyChong</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/loader/" rel="tag">loader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/module/" rel="tag">module</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongoDB/" rel="tag">mongoDB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nextTick/" rel="tag">nextTick</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/path/" rel="tag">path</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pm2/" rel="tag">pm2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/process/" rel="tag">process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/util/" rel="tag">util</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vm/" rel="tag">vm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%95%E7%BA%BF%E7%A8%8B/" rel="tag">单线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Dart/" style="font-size: 10px;">Dart</a> <a href="/tags/EventLoop/" style="font-size: 12.5px;">EventLoop</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Node/" style="font-size: 10px;">Node</a> <a href="/tags/Vue/" style="font-size: 12.5px;">Vue</a> <a href="/tags/ast/" style="font-size: 10px;">ast</a> <a href="/tags/buffer/" style="font-size: 10px;">buffer</a> <a href="/tags/class/" style="font-size: 12.5px;">class</a> <a href="/tags/core/" style="font-size: 10px;">core</a> <a href="/tags/event-loop/" style="font-size: 12.5px;">event loop</a> <a href="/tags/events/" style="font-size: 10px;">events</a> <a href="/tags/fs/" style="font-size: 15px;">fs</a> <a href="/tags/git/" style="font-size: 17.5px;">git</a> <a href="/tags/happyChong/" style="font-size: 10px;">happyChong</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/loader/" style="font-size: 10px;">loader</a> <a href="/tags/module/" style="font-size: 10px;">module</a> <a href="/tags/mongoDB/" style="font-size: 10px;">mongoDB</a> <a href="/tags/nextTick/" style="font-size: 10px;">nextTick</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/path/" style="font-size: 10px;">path</a> <a href="/tags/pm2/" style="font-size: 10px;">pm2</a> <a href="/tags/process/" style="font-size: 10px;">process</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/typescript/" style="font-size: 10px;">typescript</a> <a href="/tags/util/" style="font-size: 10px;">util</a> <a href="/tags/vm/" style="font-size: 10px;">vm</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a> <a href="/tags/webpack/" style="font-size: 20px;">webpack</a> <a href="/tags/%E5%8D%95%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">单线程</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 10px;">多线程</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 12.5px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 happyChong<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>